<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedConnect AI - GP Portal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        /* Login Page Styles */
        .login-container {
            display: flex;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
        }

        .login-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M30 30c0-11.046-8.954-20-20-20S-10 18.954-10 30s8.954 20 20 20 20-8.954 20-20zM10 50c11.046 0 20-8.954 20-20s-8.954-20-20-20-20 8.954-20 20 8.954 20 20 20z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            opacity: 0.3;
            z-index: 0;
        }

        .login-branding {
            width: 40%;
            background: linear-gradient(135deg, #0066cc 0%, #004499 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: flex-start;
            padding: 4rem;
            color: white;
            position: relative;
            z-index: 1;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border-radius: 0 15px 15px 0;
        }

        .login-branding::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Cpath d='M30 30c0-11.046-8.954-20-20-20S-10 18.954-10 30s8.954 20 20 20 20-8.954 20-20zM10 50c11.046 0 20-8.954 20-20s-8.954-20-20-20-20 8.954-20 20 8.954 20 20 20z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            opacity: 0.1;
            z-index: 0;
        }

        .login-logo {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
            z-index: 1;
            position: relative;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .login-ai-badge {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
        }

        .login-tagline {
            font-size: 1.4rem;
            margin-bottom: 3rem;
            opacity: 0.9;
            z-index: 1;
            position: relative;
        }

        .trust-badges {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            z-index: 1;
            position: relative;
        }

        .trust-badge {
            background: rgba(255, 255, 255, 0.15);
            padding: 0.8rem 1.2rem;
            border-radius: 8px;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .trust-badge:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateX(5px);
        }

        .login-form-container {
            width: 60%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            position: relative;
            z-index: 1;
        }

        .login-form {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            border: 1px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
        }

        .login-form {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            border: 1px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            width: 100%;
            max-width: 400px;
        }

        .login-form h2 {
            color: #0066cc;
            margin-bottom: 2rem;
            font-size: 2rem;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .sso-buttons {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .sso-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 12px 20px;
            border: 2px solid #e0e6ff;
            border-radius: 8px;
            background: white;
            color: #333;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .sso-btn:hover {
            border-color: #0066cc;
            box-shadow: 0 4px 12px rgba(0, 102, 204, 0.2);
            transform: translateY(-1px);
            background: #f8f9ff;
        }

        .divider {
            text-align: center;
            margin: 2rem 0;
            position: relative;
            color: #666;
        }

        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #e0e6ff;
        }

        .divider span {
            background: white;
            padding: 0 1rem;
            position: relative;
        }

        /* Main Application Styles */
        .app-container {
            display: none;
        }

        .app-container.active {
            display: block;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 15px 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 20px;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo h1 {
            color: #0066cc;
            font-size: 24px;
            font-weight: 700;
        }

        .ai-badge {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
        }

        .notifications {
            position: relative;
            background: #f8f9ff;
            border: 2px solid #0066cc;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .notifications:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 102, 204, 0.3);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #e74c3c;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .user-profile {
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 8px;
            transition: all 0.3s ease;
            position: relative;
        }

        .user-profile:hover {
            background: #f8f9ff;
        }

        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            padding: 8px 0;
            min-width: 200px;
            display: none;
            z-index: 200;
            border: 1px solid #e0e6ff;
        }

        .user-dropdown.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .dropdown-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #333;
            text-decoration: none;
        }

        .dropdown-item:hover {
            background: #f8f9ff;
            color: #0066cc;
        }

        .nav-tabs {
            background: white;
            border-radius: 15px;
            padding: 8px;
            margin-bottom: 25px;
            display: flex;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            flex-wrap: wrap;
            position: sticky;
            top: 100px;
            z-index: 90;
        }

        .nav-tab {
            flex: 1;
            text-align: center;
            padding: 12px 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            border: none;
            background: none;
            min-width: 120px;
            position: relative;
        }

        .nav-tab.active {
            background: linear-gradient(45deg, #0066cc, #004499);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 102, 204, 0.4);
            transform: translateY(-1px);
        }

        .nav-tab:not(.active):hover {
            background: #f8f9ff;
            color: #0066cc;
            transform: translateY(-1px);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }

        .urgent-banner {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            animation: urgentPulse 3s infinite;
        }

        @keyframes urgentPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.4); }
            50% { box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); }
        }

        .urgent-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .urgent-icon {
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: shake 1s infinite;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }

        .btn {
            background: linear-gradient(45deg, #0066cc, #004499);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 102, 204, 0.4);
        }

        .btn:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.2);
        }

        .btn-secondary {
            background: white;
            color: #0066cc;
            border: 2px solid #0066cc;
        }

        .btn-secondary:hover {
            background: #0066cc;
            color: white;
        }

        .btn-urgent {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            animation: buttonPulse 2s infinite;
        }

        @keyframes buttonPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .btn-success {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 6px;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .ai-insights {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .ai-insights::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffffff' fill-opacity='0.05' fill-rule='evenodd'%3E%3Cpath d='m0 40l40-40h-40v40zm40 0v-40h-40l40 40z'/%3E%3C/g%3E%3C/svg%3E");
            pointer-events: none;
        }

        .ai-insights h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }

        .ai-icon {
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: rotate 10s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .ai-insights p {
            position: relative;
            z-index: 1;
            margin-bottom: 10px;
        }

        .ai-priority-badge {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            animation: aiGlow 2s infinite alternate;
        }

        @keyframes aiGlow {
            from { box-shadow: 0 0 5px rgba(102, 126, 234, 0.5); }
            to { box-shadow: 0 0 15px rgba(102, 126, 234, 0.8); }
        }

        .patient-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .patient-card {
            background: #f8f9ff;
            border: 1px solid #e0e6ff;
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .patient-card:hover {
            border-color: #0066cc;
            box-shadow: 0 4px 15px rgba(0, 102, 204, 0.2);
            transform: translateY(-1px);
        }

        .patient-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .patient-name {
            font-weight: 600;
            color: #333;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .status-urgent {
            background: #fee;
            color: #e74c3c;
            animation: urgentBlink 2s infinite;
        }

        @keyframes urgentBlink {
            0%, 50%, 100% { opacity: 1; }
            25%, 75% { opacity: 0.7; }
        }

        .status-routine {
            background: #e8f5e8;
            color: #27ae60;
        }

        .status-pending {
            background: #fff4e6;
            color: #f39c12;
        }

        .patient-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            font-size: 14px;
            color: #666;
        }

        .calendar-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .calendar-nav button {
            background: #f8f9ff;
            border: 1px solid #e0e6ff;
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .calendar-nav button:hover {
            background: #0066cc;
            color: white;
            transform: translateY(-1px);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #e0e6ff;
            border-radius: 10px;
            overflow: hidden;
        }

        .calendar-day-header {
            background: #0066cc;
            color: white;
            padding: 15px 10px;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
        }

        .calendar-day {
            background: white;
            min-height: 120px;
            padding: 8px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .calendar-day:hover {
            background: #f8f9ff;
        }

        .calendar-day.other-month {
            background: #f5f5f5;
            color: #ccc;
        }

        .calendar-day.today {
            background: #fff4e6;
            border: 2px solid #f39c12;
        }

        .calendar-day.unavailable {
            background: #f5f5f5 !important;
            color: #999 !important;
            position: relative;
            cursor: not-allowed;
        }

        .calendar-day.unavailable::after {
            content: 'Unavailable';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 10px;
            color: #999;
            background: rgba(255,255,255,0.8);
            padding: 2px 4px;
            border-radius: 3px;
        }

        .day-number {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .appointment {
            background: #0066cc;
            color: white;
            font-size: 10px;
            padding: 1px 4px;
            border-radius: 3px;
            margin-bottom: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            text-overflow: ellipsis;
            overflow: hidden;
            white-space: nowrap;
        }

        .appointment:hover {
            background: #004499;
            transform: scale(1.02);
            z-index: 10;
            position: relative;
        }

        .appointment.urgent {
            background: #e74c3c;
        }

        .appointment.urgent:hover {
            background: #c0392b;
        }

        .appointment.consultation {
            background: #27ae60;
        }

        .appointment.consultation:hover {
            background: #219a52;
        }

        .appointment.follow-up {
            background: #f39c12;
        }

        .appointment.follow-up:hover {
            background: #e67e22;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #0066cc, #004499);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 102, 204, 0.3);
        }

        .stat-number {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
            animation: countUp 2s ease;
        }

        @keyframes countUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.9;
        }

        .recent-activity {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.3s ease;
        }

        .activity-item:hover {
            background: #f8f9ff;
            padding-left: 8px;
            border-radius: 8px;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            background: #f8f9ff;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #0066cc;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 600;
            margin-bottom: 2px;
        }

        .activity-time {
            font-size: 12px;
            color: #666;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            margin: auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-50px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .modal-content.large {
            max-width: 900px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .close-btn {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
            background: none;
            border: none;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            color: #e74c3c;
            transform: scale(1.1);
        }

        .modal-body {
            max-height: 60vh;
            overflow-y: auto;
        }

        .modal-footer {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group.required label::after {
            content: ' *';
            color: #e74c3c;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e6ff;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #0066cc;
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
            transform: translateY(-1px);
        }

        .form-group input.error,
        .form-group select.error,
        .form-group textarea.error {
            border-color: #e74c3c;
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1);
        }

        .form-grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .form-grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }

        .search-container {
            position: relative;
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 12px 45px 12px 15px;
            border: 2px solid #e0e6ff;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #0066cc;
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #0066cc;
            animation: searchPulse 3s infinite;
        }

        @keyframes searchPulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        .filter-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-tab {
            padding: 8px 16px;
            border: 2px solid #e0e6ff;
            border-radius: 20px;
            background: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .filter-tab.active {
            background: #0066cc;
            color: white;
            border-color: #0066cc;
            transform: translateY(-1px);
        }

        .filter-tab:hover:not(.active) {
            border-color: #0066cc;
            color: #0066cc;
        }

        .referral-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .referral-table th,
        .referral-table td {
            text-align: left;
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .referral-table th {
            background: #f8f9ff;
            font-weight: 600;
            color: #333;
            position: sticky;
            top: 0;
        }

        .referral-table tr {
            transition: all 0.3s ease;
        }

        .referral-table tr:hover {
            background: #f8f9ff;
            transform: scale(1.01);
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .today-schedule {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .schedule-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.3s ease;
        }

        .schedule-item:hover {
            background: #f8f9ff;
            padding-left: 8px;
            border-radius: 8px;
        }

        .schedule-item:last-child {
            border-bottom: none;
        }

        .schedule-time {
            font-weight: 600;
            color: #0066cc;
            min-width: 80px;
        }

        .schedule-details {
            flex: 1;
            margin-left: 15px;
        }

        .schedule-patient {
            font-weight: 600;
            margin-bottom: 2px;
        }

        .schedule-type {
            font-size: 12px;
            color: #666;
        }

        .progress-indicator {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            position: relative;
        }

        .progress-step {
            text-align: center;
            flex: 1;
        }

        .progress-dot {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e0e6ff;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin: 0 auto 10px;
            transition: all 0.3s ease;
        }

        .progress-dot.active {
            background: #0066cc;
            color: white;
            animation: progressPulse 2s infinite;
        }

        @keyframes progressPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .progress-label {
            font-size: 12px;
            color: #666;
        }

        .ai-suggestion-box {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .ai-suggestion-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='30' height='30' viewBox='0 0 30 30' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Cpath d='M15 15l15-15v15h-15zM0 0l15 15H0V0z'/%3E%3C/g%3E%3C/svg%3E");
            animation: aiPattern 20s linear infinite;
        }

        @keyframes aiPattern {
            from { transform: translateX(-30px); }
            to { transform: translateX(0); }
        }

        .ai-suggestion-box strong {
            position: relative;
            z-index: 1;
        }

        .specialist-card {
            border: 2px solid #e0e6ff;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .specialist-card:hover {
            border-color: #0066cc;
            box-shadow: 0 4px 15px rgba(0, 102, 204, 0.2);
            transform: translateY(-2px);
        }

        .specialist-card.selected {
            border-color: #0066cc;
            background: #f8f9ff;
            box-shadow: 0 4px 15px rgba(0, 102, 204, 0.3);
        }

        .specialist-card.ai-recommended::before {
            content: 'ðŸ¤– AI RECOMMENDED';
            position: absolute;
            top: -8px;
            right: 15px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            animation: aiRecommendation 3s infinite;
        }

        @keyframes aiRecommendation {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .specialist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .specialist-name {
            font-weight: 600;
            color: #333;
        }

        .ai-match-score {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            animation: matchGlow 2s infinite alternate;
        }

        @keyframes matchGlow {
            from { box-shadow: 0 0 5px rgba(102, 126, 234, 0.5); }
            to { box-shadow: 0 0 15px rgba(102, 126, 234, 0.8); }
        }

        .specialist-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            font-size: 14px;
            color: #666;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 600;
            color: #333;
        }

        .detail-value {
            color: #666;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checkbox-label:hover {
            color: #0066cc;
        }

        .notification-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border: 1px solid #e0e6ff;
            border-radius: 8px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .notification-toggle:hover {
            border-color: #0066cc;
            background: #f8f9ff;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
            background: #ccc;
            border-radius: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-switch.active {
            background: #0066cc;
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(26px);
        }

        .message-thread {
            background: #f8f9ff;
            border-radius: 10px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 15px;
            border: 1px solid #e0e6ff;
        }

        .message {
            margin-bottom: 15px;
        }

        .message.received {
            text-align: left;
        }

        .message.sent {
            text-align: right;
        }

        .message-bubble {
            display: inline-block;
            max-width: 70%;
            padding: 10px 15px;
            border-radius: 10px;
            margin-bottom: 5px;
            animation: messageSlide 0.5s ease;
        }

        @keyframes messageSlide {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.received .message-bubble {
            background: white;
            border: 1px solid #e0e6ff;
        }

        .message.sent .message-bubble {
            background: #0066cc;
            color: white;
        }

        .message-time {
            font-size: 11px;
            color: #666;
            opacity: 0.7;
        }

        /* Toast Notification System */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #0066cc;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            z-index: 10000;
            animation: toastSlideIn 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 102, 204, 0.3);
            max-width: 300px;
        }

        .toast.success {
            background: #27ae60;
        }

        .toast.error {
            background: #e74c3c;
        }

        .toast.warning {
            background: #f39c12;
        }

        @keyframes toastSlideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .toast.hiding {
            animation: toastSlideOut 0.3s ease forwards;
        }

        @keyframes toastSlideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        /* Support Center Styles */
        .support-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .support-card {
            background: white;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border: 1px solid #e0e6ff;
        }

        .support-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-color: #0066cc;
        }

        .support-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .faq-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .faq-item {
            border-bottom: 1px solid #e0e6ff;
            padding: 15px 0;
        }

        .faq-item:last-child {
            border-bottom: none;
        }

        .faq-question {
            cursor: pointer;
            font-weight: 600;
            color: #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .faq-question:hover {
            color: #0066cc;
        }

        .faq-answer {
            display: none;
            padding-top: 10px;
            color: #666;
            line-height: 1.6;
            animation: fadeIn 0.3s ease;
        }

        .faq-answer.show {
            display: block;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .quick-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .login-container {
                flex-direction: column;
            }
            
            .login-branding,
            .login-form-container {
                width: 100%;
            }
            
            .login-branding {
                padding: 2rem;
                text-align: center;
            }
            
            .container {
                padding: 10px;
            }
            
            .header {
                padding: 10px 15px;
                margin-bottom: 15px;
            }
            
            .nav-tabs {
                overflow-x: auto;
                padding: 5px;
            }
            
            .nav-tab {
                min-width: 100px;
                padding: 10px 12px;
            }
            
            .calendar-grid {
                font-size: 12px;
            }
            
            .calendar-day {
                min-height: 80px;
                padding: 4px;
            }
            
            .quick-stats {
                grid-template-columns: 1fr;
            }
            
            .form-grid-2,
            .form-grid-3 {
                grid-template-columns: 1fr;
            }
            
            .filter-tabs {
                overflow-x: auto;
            }
            
            .modal-content {
                width: 95%;
                margin: 10px;
                padding: 20px;
            }
            
            .support-grid {
                grid-template-columns: 1fr;
            }
            
            .toast {
                left: 10px;
                right: 10px;
                max-width: none;
            }
        }

        @media (max-width: 480px) {
            .logo h1 {
                font-size: 18px;
            }
            
            .stat-number {
                font-size: 24px;
            }
            
            .modal-content {
                height: 90vh;
                overflow-y: auto;
            }
        }

        /* Loading States */
        .loading {
            opacity: 0.6;
            pointer-events: none;
            position: relative;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid #0066cc;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s infinite linear;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Auto-save indicator */
        .auto-save-indicator {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: #27ae60;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .auto-save-indicator.show {
            opacity: 1;
        }

        /* Task Management Styles */
        .task-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .task-item {
            background: #f8f9ff;
            border: 1px solid #e0e6ff;
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .task-item:hover {
            border-color: #0066cc;
            box-shadow: 0 4px 15px rgba(0, 102, 204, 0.2);
            transform: translateY(-1px);
        }

        .task-item.high-priority {
            border-left: 4px solid #e74c3c;
            background: #fef5f5;
        }

        .task-item.medium-priority {
            border-left: 4px solid #f39c12;
            background: #fefaf5;
        }

        .task-item.low-priority {
            border-left: 4px solid #27ae60;
            background: #f5fef8;
        }

        .task-priority-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            min-width: 100px;
            text-align: center;
        }

        .task-priority-badge.high {
            background: #fee;
            color: #e74c3c;
        }

        .task-priority-badge.medium {
            background: #fff4e6;
            color: #f39c12;
        }

        .task-priority-badge.low {
            background: #e8f5e8;
            color: #27ae60;
        }

        .task-content {
            flex: 1;
        }

        .task-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }

        .task-details {
            font-size: 14px;
            color: #666;
            margin-bottom: 3px;
        }

        .task-overdue {
            font-size: 12px;
            color: #e74c3c;
            font-weight: 600;
        }

        .overdue-referral-banner {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            animation: urgentPulse 3s infinite;
        }

        .overdue-content {
            flex: 1;
        }

        /* Referral Status Tracking */
        .status-timeline {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 30px 0;
            position: relative;
        }

        .status-timeline::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background: #e0e6ff;
            z-index: 1;
        }

        .status-step {
            text-align: center;
            position: relative;
            z-index: 2;
            background: white;
            padding: 0 10px;
        }

        .status-dot {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e0e6ff;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin: 0 auto 10px;
            transition: all 0.3s ease;
        }

        .status-dot.completed {
            background: #27ae60;
            color: white;
        }

        .status-dot.current {
            background: #0066cc;
            color: white;
            animation: statusPulse 2s infinite;
        }

        @keyframes statusPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .status-label {
            font-size: 12px;
            color: #666;
            font-weight: 600;
        }

        .status-time {
            font-size: 11px;
            color: #999;
            margin-top: 2px;
        }

        .ai-status-box {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .ai-status-box strong {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Alternative Specialists Styling */
        .alternative-specialist {
            background: #e8f5e8;
            border: 2px solid #27ae60;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
        }

        .alternative-specialist::before {
            content: '#1 ALTERNATIVE - 96% CONFIDENCE';
            position: absolute;
            top: -8px;
            left: 15px;
            background: #27ae60;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
        }

        .specialist-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .specialist-stat {
            text-align: center;
            padding: 8px;
            background: white;
            border-radius: 6px;
        }

        .specialist-stat-value {
            font-weight: 600;
            color: #27ae60;
            font-size: 14px;
        }

        .specialist-stat-label {
            font-size: 11px;
            color: #666;
        }

        /* Query Response Styling */
        .query-details {
            background: #f8f9ff;
            border: 1px solid #e0e6ff;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .query-question {
            background: white;
            border-left: 4px solid #0066cc;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }

        .query-response-area {
            margin: 20px 0;
        }

        .query-response-area textarea {
            min-height: 120px;
            resize: vertical;
        }

        /* Accessibility improvements */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0,0,0,0);
            white-space: nowrap;
            border: 0;
        }

        /* Focus styles for better accessibility */
        *:focus {
            outline: 2px solid #0066cc;
            outline-offset: 2px;
        }

        button:focus,
        .btn:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.3);
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            .card {
                border: 2px solid #000;
            }
            
            .btn {
                border: 2px solid;
            }
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0,0,0,0);
            white-space: nowrap;
            border: 0;
        }

        /* Focus styles for better accessibility */
        *:focus {
            outline: 2px solid #0066cc;
            outline-offset: 2px;
        }

        button:focus,
        .btn:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.3);
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            .card {
                border: 2px solid #000;
            }
            
            .btn {
                border: 2px solid;
            }
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-branding">
            <div class="login-logo">
                MedConnect
                <span class="login-ai-badge">AI</span>
            </div>
            <div class="login-tagline">Intelligent Healthcare Referral Management</div>
            <div class="trust-badges">
                <div class="trust-badge">ðŸ”’ AHPRA Certified Platform</div>
                <div class="trust-badge">ðŸ›¡ï¸ Privacy Act 1988 Compliant</div>
                <div class="trust-badge">âš¡ AI-Powered Triage System</div>
                <div class="trust-badge">ðŸ¥ Trusted by 500+ Practices</div>
            </div>
        </div>
        <div class="login-form-container">
            <div class="login-form">
                <h2>
                    ðŸ¥ Secure Login
                </h2>
                
                <div class="sso-buttons">
                    <button class="sso-btn" onclick="ssoLogin('ahpra')">
                        <span>ðŸ¥</span> Login with AHPRA
                    </button>
                    <button class="sso-btn" onclick="ssoLogin('proda')">
                        <span>ðŸ”</span> Login with PRODA
                    </button>
                    <button class="sso-btn" onclick="ssoLogin('mygov')">
                        <span>ðŸ‡¦ðŸ‡º</span> Login with MyGovID
                    </button>
                </div>

                <div class="divider">
                    <span>or continue with email</span>
                </div>

                <form onsubmit="login(event)">
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" required placeholder="dr.sarah@practice.com.au">
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" required placeholder="Enter your password">
                    </div>
                    <button type="submit" class="btn" style="width: 100%; margin-top: 20px;">
                        Sign In to Dashboard
                    </button>
                </form>

                <div style="text-align: center; margin-top: 20px; font-size: 14px; color: #666;">
                    Need help? <a href="#" onclick="showToast('Support team contacted', 'info')" style="color: #0066cc;">Contact Support</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="appContainer" class="app-container">
        <div class="container">
            <!-- Header -->
            <div class="header">
                <div class="logo">
                    <h1>MedConnect</h1>
                    <span class="ai-badge">AI</span>
                </div>
                <div class="user-info">
                    <div class="notifications" onclick="showNotifications()">
                        <span>ðŸ””</span>
                        <span class="notification-badge">3</span>
                    </div>
                    <div class="user-profile" onclick="toggleUserDropdown()">
                        <div>
                            <strong>Dr. Sarah Mitchell</strong>
                            <div style="font-size: 12px; color: #666;">General Practitioner</div>
                        </div>
                        <div class="user-dropdown" id="userDropdown">
                            <a href="#" class="dropdown-item" onclick="showTab('profile')">
                                <span>ðŸ‘¤</span> My Profile
                            </a>
                            <a href="#" class="dropdown-item" onclick="showTab('profile')">
                                <span>âš™ï¸</span> Settings
                            </a>
                            <a href="#" class="dropdown-item" onclick="showTab('support')">
                                <span>â“</span> Help & Support
                            </a>
                            <div style="border-top: 1px solid #e0e6ff; margin: 8px 0;"></div>
                            <a href="#" class="dropdown-item" onclick="logout()">
                                <span>ðŸšª</span> Log Out
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Navigation Tabs -->
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showTab('dashboard')">Dashboard</button>
                <button class="nav-tab" onclick="showTab('referrals')">Referrals</button>
                <button class="nav-tab" onclick="showTab('calendar')">Calendar</button>
                <button class="nav-tab" onclick="showTab('patients')">Patients</button>
                <button class="nav-tab" onclick="showTab('analytics')">Analytics</button>
                <button class="nav-tab" onclick="showTab('messages')">Messages</button>
                <button class="nav-tab" onclick="showTab('profile')">Profile</button>
                <button class="nav-tab" onclick="showTab('support')">Support</button>
            </div>

            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <!-- Tasks Requiring Action Widget -->
                <div class="card" style="margin-bottom: 25px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>ðŸ“‹ Tasks Requiring Your Action (6)</h3>
                        <button class="btn btn-small btn-secondary" onclick="showAllTasks()">View All Tasks</button>
                    </div>
                    
                    <div class="task-list">
                        <div class="task-item high-priority" onclick="openSpecialistQuery('REF2025-1244')">
                            <div class="task-priority-badge high">HIGH PRIORITY</div>
                            <div class="task-content">
                                <div class="task-title">Dr. Wong requesting additional history for Sarah O'Brien</div>
                                <div class="task-details">Neurology referral #2025-1244 | Needs: Previous headache patterns, family history</div>
                                <div class="task-overdue">Overdue by 2 days - Response needed by EOD</div>
                            </div>
                            <button class="btn btn-small btn-urgent">Respond Now</button>
                        </div>

                        <div class="task-item medium-priority" onclick="completeChecklist('john-mitchell')">
                            <div class="task-priority-badge medium">MEDIUM PRIORITY</div>
                            <div class="task-content">
                                <div class="task-title">John Mitchell pre-appointment checklist incomplete</div>
                                <div class="task-details">Cardiology appointment tomorrow 10:30 AM | Missing: Recent ECG, medication list</div>
                            </div>
                            <button class="btn btn-small">Complete</button>
                        </div>

                        <div class="task-item medium-priority" onclick="reviewTestResults('jennifer-adams')">
                            <div class="task-priority-badge medium">MEDIUM PRIORITY</div>
                            <div class="task-content">
                                <div class="task-title">Jennifer Adams - Test results review pending</div>
                                <div class="task-details">HbA1c results received | Needs: Follow-up appointment scheduling</div>
                            </div>
                            <button class="btn btn-small">Review</button>
                        </div>

                        <div class="task-item low-priority" onclick="scheduleHealthCheck('david-nguyen')">
                            <div class="task-priority-badge low">LOW PRIORITY</div>
                            <div class="task-content">
                                <div class="task-title">David Nguyen - Annual health check due</div>
                                <div class="task-details">Last check: 11/10/2024 | Due for: Blood pressure, cholesterol, diabetes screening</div>
                            </div>
                            <button class="btn btn-small">Schedule</button>
                        </div>
                    </div>
                </div>

                <!-- Overdue Referral Alert -->
                <div class="overdue-referral-banner">
                    <div class="overdue-content">
                        <div>
                            <strong>Michael Brown - Overdue Gastroenterology Response</strong>
                            <div style="font-size: 14px; opacity: 0.9;">Patient MRN: MCA-2022-5678 | 48M | Original referral: 14/10/2025</div>
                            <div style="font-size: 14px; margin-top: 5px;"><strong>OVERDUE:</strong> Dr. Patel hasn't responded to referral sent 3 days ago. Patient experiencing worsening abdominal pain. Alternative specialists available with shorter wait times.</div>
                        </div>
                    </div>
                    <button class="btn btn-urgent" onclick="openEscalateModal('michael-brown')">ESCALATE & RE-ROUTE</button>
                </div>

                <div class="dashboard-grid">
                    <div class="main-content">
                        <!-- Urgent Alert Banner -->
                        <div class="urgent-banner">
                            <div class="urgent-content">
                                <div class="urgent-icon">âš ï¸</div>
                                <div>
                                    <strong>URGENT:</strong> Patient Emma Thompson requires immediate specialist referral
                                    <span class="ai-priority-badge">ðŸ¤– AI Priority</span>
                                </div>
                            </div>
                            <button class="btn btn-urgent" onclick="openUrgentReferral()">CREATE URGENT REFERRAL</button>
                        </div>

                        <!-- AI Insights -->
                        <div class="ai-insights">
                            <h3>
                                <div class="ai-icon">ðŸ¤–</div>
                                AI Clinical Insights - 96% Accuracy
                            </h3>
                            <div>
                                <p><strong>â€¢ High-Risk Alert:</strong> 3 patients showing cardiac risk factors - consider preventive referrals 
                                    <span class="ai-priority-badge">ðŸ¤– AI Detected</span></p>
                                <p><strong>â€¢ Efficiency Opportunity:</strong> 12 routine referrals could be batched to Cardiology - save 2.5 hours</p>
                                <p><strong>â€¢ Resource Optimization:</strong> Tuesday 2-4 PM slot availability at Metro Specialist Center</p>
                                <p><strong>â€¢ Pattern Detection:</strong> 15% increase in respiratory conditions - flu season prep recommended</p>
                            </div>
                        </div>

                        <!-- Today's Priority Patients -->
                        <div class="card">
                            <h3 style="margin-bottom: 20px;">Today's Priority Patients</h3>
                            <div class="patient-list">
                                <div class="patient-card" onclick="openPatientDetails('emma-thompson')">
                                    <div class="patient-header">
                                        <span class="patient-name">Emma Thompson</span>
                                        <div>
                                            <span class="status-badge status-urgent">URGENT</span>
                                            <span class="ai-priority-badge">ðŸ¤– AI Priority</span>
                                        </div>
                                    </div>
                                    <div class="patient-details">
                                        <div>Age: 45</div>
                                        <div>Condition: Chest Pain</div>
                                        <div>Specialist: Cardiology</div>
                                        <div>Priority: High</div>
                                        <div>MRN: MCA-2024-0156</div>
                                        <div>Medicare: 2847 59183 4</div>
                                    </div>
                                </div>

                                <div class="patient-card" onclick="openPatientDetails('john-davis')">
                                    <div class="patient-header">
                                        <span class="patient-name">John Davis</span>
                                        <span class="status-badge status-routine">ROUTINE</span>
                                    </div>
                                    <div class="patient-details">
                                        <div>Age: 62</div>
                                        <div>Condition: Joint Pain</div>
                                        <div>Specialist: Orthopedics</div>
                                        <div>Priority: Medium</div>
                                        <div>MRN: MCA-2024-0247</div>
                                        <div>Medicare: 3956 48271 9</div>
                                    </div>
                                </div>

                                <div class="patient-card" onclick="openPatientDetails('maria-garcia')">
                                    <div class="patient-header">
                                        <span class="patient-name">Maria Garcia</span>
                                        <span class="status-badge status-pending">PENDING</span>
                                    </div>
                                    <div class="patient-details">
                                        <div>Age: 38</div>
                                        <div>Condition: Skin Lesion</div>
                                        <div>Specialist: Dermatology</div>
                                        <div>Priority: Low</div>
                                        <div>MRN: MCA-2024-0398</div>
                                        <div>Medicare: 4738 29516 2</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="sidebar">
                        <!-- Quick Stats -->
                        <div class="quick-stats">
                            <div class="stat-card">
                                <div class="stat-number">24</div>
                                <div class="stat-label">Active Referrals</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">8</div>
                                <div class="stat-label">Pending Approvals</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">156</div>
                                <div class="stat-label">Total Patients</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">96%</div>
                                <div class="stat-label">AI Accuracy</div>
                            </div>
                        </div>

                        <!-- Today's Schedule -->
                        <div class="today-schedule">
                            <h3 style="margin-bottom: 15px;">Today's Schedule</h3>
                            <div class="schedule-item">
                                <div class="schedule-time">9:00 AM</div>
                                <div class="schedule-details">
                                    <div class="schedule-patient">James Wilson</div>
                                    <div class="schedule-type">General Consultation</div>
                                </div>
                            </div>
                            <div class="schedule-item">
                                <div class="schedule-time">10:30 AM</div>
                                <div class="schedule-details">
                                    <div class="schedule-patient">Lisa Chen</div>
                                    <div class="schedule-type">Follow-up Visit</div>
                                </div>
                            </div>
                            <div class="schedule-item">
                                <div class="schedule-time">2:00 PM</div>
                                <div class="schedule-details">
                                    <div class="schedule-patient">Robert Taylor</div>
                                    <div class="schedule-type">New Patient</div>
                                </div>
                            </div>
                            <div class="schedule-item">
                                <div class="schedule-time">3:30 PM</div>
                                <div class="schedule-details">
                                    <div class="schedule-patient">Emma Thompson</div>
                                    <div class="schedule-type">Urgent Consultation</div>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Activity -->
                        <div class="recent-activity">
                            <h3 style="margin-bottom: 15px;">Recent Activity</h3>
                            <div class="activity-item">
                                <div class="activity-icon">ðŸ“‹</div>
                                <div class="activity-content">
                                    <div class="activity-title">Referral Approved 
                                        <span class="ai-priority-badge">ðŸ¤– 95% Match</span>
                                    </div>
                                    <div class="activity-time">Dr. John Smith - 2 hours ago</div>
                                </div>
                            </div>
                            <div class="activity-item">
                                <div class="activity-icon">ðŸ“…</div>
                                <div class="activity-content">
                                    <div class="activity-title">Appointment Scheduled</div>
                                    <div class="activity-time">Lisa Chen - 4 hours ago</div>
                                </div>
                            </div>
                            <div class="activity-item">
                                <div class="activity-icon">ðŸ“§</div>
                                <div class="activity-content">
                                    <div class="activity-title">New Message</div>
                                    <div class="activity-time">Hospital Coordinator - 6 hours ago</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Referrals Tab -->
            <div id="referrals" class="tab-content">
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2>Referral Management</h2>
                        <button class="btn" onclick="openNewReferralModal()">Create New Referral</button>
                    </div>

                    <div class="search-container">
                        <input type="text" class="search-input" placeholder="Search patients, conditions, or specialists..." id="referralSearch">
                        <span class="search-icon">ðŸ”</span>
                    </div>

                    <div class="filter-tabs">
                        <button class="filter-tab active" onclick="filterReferrals('all')">All</button>
                        <button class="filter-tab" onclick="filterReferrals('urgent')">Urgent</button>
                        <button class="filter-tab" onclick="filterReferrals('pending')">Pending</button>
                        <button class="filter-tab" onclick="filterReferrals('approved')">Approved</button>
                        <button class="filter-tab" onclick="filterReferrals('completed')">Completed</button>
                    </div>

                    <table class="referral-table">
                        <thead>
                            <tr>
                                <th>Patient</th>
                                <th>Condition</th>
                                <th>Specialist</th>
                                <th>Priority</th>
                                <th>Status</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="referralTableBody">
                            <tr onclick="openReferralDetails('REF001')">
                                <td>Emma Thompson</td>
                                <td>Chest Pain - Cardiac Assessment</td>
                                <td>Dr. John Smith (Cardiology) <span class="ai-priority-badge">ðŸ¤– 97%</span></td>
                                <td><span class="status-badge status-urgent">URGENT</span></td>
                                <td><span class="status-badge status-pending">Pending</span></td>
                                <td>17/10/2024</td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-small" onclick="event.stopPropagation(); openReferralDetails('REF001')">View</button>
                                        <button class="btn btn-small btn-secondary" onclick="event.stopPropagation(); editReferral('REF001')">Edit</button>
                                    </div>
                                </td>
                            </tr>
                            <tr onclick="openReferralDetails('REF002')">
                                <td>John Davis</td>
                                <td>Chronic Joint Pain - Arthritis</td>
                                <td>Dr. Sarah Johnson (Orthopedics) <span class="ai-priority-badge">ðŸ¤– 94%</span></td>
                                <td><span class="status-badge status-routine">ROUTINE</span></td>
                                <td><span class="status-badge status-routine">Approved</span></td>
                                <td>16/10/2024</td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-small" onclick="event.stopPropagation(); openReferralDetails('REF002')">View</button>
                                        <button class="btn btn-small btn-secondary" onclick="event.stopPropagation(); editReferral('REF002')">Edit</button>
                                    </div>
                                </td>
                            </tr>
                            <tr onclick="openReferralDetails('REF003')">
                                <td>Maria Garcia</td>
                                <td>Suspicious Skin Lesion</td>
                                <td>Dr. Mike Brown (Dermatology) <span class="ai-priority-badge">ðŸ¤– 91%</span></td>
                                <td><span class="status-badge status-routine">ROUTINE</span></td>
                                <td><span class="status-badge status-pending">Pending</span></td>
                                <td>15/10/2024</td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-small" onclick="event.stopPropagation(); openReferralDetails('REF003')">View</button>
                                        <button class="btn btn-small btn-secondary" onclick="event.stopPropagation(); editReferral('REF003')">Edit</button>
                                    </div>
                                </td>
                            </tr>
                            <tr onclick="openReferralDetails('REF004')">
                                <td>Peter Williams</td>
                                <td>Neurological Assessment</td>
                                <td>Dr. Amanda Lee (Neurology) <span class="ai-priority-badge">ðŸ¤– 89%</span></td>
                                <td><span class="status-badge status-urgent">URGENT</span></td>
                                <td><span class="status-badge status-routine">Approved</span></td>
                                <td>14/10/2024</td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-small" onclick="event.stopPropagation(); openReferralDetails('REF004')">View</button>
                                        <button class="btn btn-small btn-secondary" onclick="event.stopPropagation(); editReferral('REF004')">Edit</button>
                                    </div>
                                </td>
                            </tr>
                            <tr onclick="openReferralDetails('REF005')">
                                <td>Susan Clark</td>
                                <td>Gastroenterology Consultation</td>
                                <td>Dr. Robert Chen (Gastroenterology) <span class="ai-priority-badge">ðŸ¤– 96%</span></td>
                                <td><span class="status-badge status-routine">ROUTINE</span></td>
                                <td><span class="status-badge status-routine">Completed</span></td>
                                <td>13/10/2024</td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-small" onclick="event.stopPropagation(); openReferralDetails('REF005')">View</button>
                                        <button class="btn btn-small btn-secondary" onclick="event.stopPropagation(); downloadReport('REF005')">Report</button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Calendar Tab -->
            <div id="calendar" class="tab-content">
                <div class="calendar-container">
                    <div class="calendar-header">
                        <h2 id="currentMonth">October 2024</h2>
                        <div class="calendar-nav">
                            <button onclick="previousMonth()">â® Previous</button>
                            <button onclick="nextMonth()">Next â¯</button>
                            <button onclick="todayView()">Today</button>
                            <button class="btn" onclick="openAppointmentModal()">+ Add Appointment</button>
                        </div>
                    </div>

                    <div class="calendar-grid" id="calendarGrid">
                        <!-- Calendar will be dynamically generated -->
                    </div>

                    <div style="margin-top: 20px;">
                        <h3>Upcoming Appointments <span class="ai-priority-badge">ðŸ¤– AI Optimized</span></h3>
                        <div class="upcoming-appointments">
                            <div class="schedule-item">
                                <div class="schedule-time">Tomorrow 9:00 AM</div>
                                <div class="schedule-details">
                                    <div class="schedule-patient">Michael Brown - Follow-up</div>
                                    <div class="schedule-type">Room 3 | Dr. Sarah Mitchell</div>
                                </div>
                            </div>
                            <div class="schedule-item">
                                <div class="schedule-time">Mon 18th 2:30 PM</div>
                                <div class="schedule-details">
                                    <div class="schedule-patient">Emily Johnson - New Patient</div>
                                    <div class="schedule-type">Room 1 | Dr. Sarah Mitchell</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Patients Tab -->
            <div id="patients" class="tab-content">
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2>Patient Management</h2>
                        <button class="btn" onclick="openNewPatientModal()">Add New Patient</button>
                    </div>
                    
                    <div class="search-container">
                        <input type="text" class="search-input" placeholder="Search patients by name, ID, or condition...">
                        <span class="search-icon">ðŸ”</span>
                    </div>

                    <div class="patient-list">
                        <div class="patient-card">
                            <div class="patient-header">
                                <span class="patient-name">Emma Thompson</span>
                                <div>
                                    <span class="status-badge status-urgent">HIGH RISK</span>
                                    <span class="ai-priority-badge">ðŸ¤– AI Monitored</span>
                                </div>
                            </div>
                            <div class="patient-details">
                                <div>ID: MCA-2024-0156</div>
                                <div>Age: 45</div>
                                <div>Medicare: 2847 59183 4</div>
                                <div>Last Visit: Oct 15, 2024</div>
                                <div>Next: Oct 17, 2024</div>
                                <div>Active Referrals: 1</div>
                            </div>
                            <div style="margin-top: 10px;">
                                <button class="btn btn-small" onclick="openPatientDetails('emma-thompson')">View Details</button>
                                <button class="btn btn-small btn-secondary" onclick="openNewReferralModal('emma-thompson')">Create Referral</button>
                            </div>
                        </div>

                        <div class="patient-card">
                            <div class="patient-header">
                                <span class="patient-name">John Davis</span>
                                <span class="status-badge status-routine">STABLE</span>
                            </div>
                            <div class="patient-details">
                                <div>ID: MCA-2024-0247</div>
                                <div>Age: 62</div>
                                <div>Medicare: 3956 48271 9</div>
                                <div>Last Visit: Oct 12, 2024</div>
                                <div>Next: Nov 12, 2024</div>
                                <div>Active Referrals: 1</div>
                            </div>
                            <div style="margin-top: 10px;">
                                <button class="btn btn-small" onclick="openPatientDetails('john-davis')">View Details</button>
                                <button class="btn btn-small btn-secondary" onclick="openNewReferralModal('john-davis')">Create Referral</button>
                            </div>
                        </div>

                        <div class="patient-card">
                            <div class="patient-header">
                                <span class="patient-name">Maria Garcia</span>
                                <span class="status-badge status-pending">MONITORING</span>
                            </div>
                            <div class="patient-details">
                                <div>ID: MCA-2024-0398</div>
                                <div>Age: 38</div>
                                <div>Medicare: 4738 29516 2</div>
                                <div>Last Visit: Oct 10, 2024</div>
                                <div>Next: Oct 20, 2024</div>
                                <div>Active Referrals: 1</div>
                            </div>
                            <div style="margin-top: 10px;">
                                <button class="btn btn-small" onclick="openPatientDetails('maria-garcia')">View Details</button>
                                <button class="btn btn-small btn-secondary" onclick="openNewReferralModal('maria-garcia')">Create Referral</button>
                            </div>
                        </div>

                        <div class="patient-card">
                            <div class="patient-header">
                                <span class="patient-name">Peter Williams</span>
                                <span class="status-badge status-routine">STABLE</span>
                            </div>
                            <div class="patient-details">
                                <div>ID: MCA-2024-0429</div>
                                <div>Age: 51</div>
                                <div>Medicare: 5829 37164 8</div>
                                <div>Last Visit: Oct 8, 2024</div>
                                <div>Next: Nov 8, 2024</div>
                                <div>Active Referrals: 0</div>
                            </div>
                            <div style="margin-top: 10px;">
                                <button class="btn btn-small" onclick="openPatientDetails('peter-williams')">View Details</button>
                                <button class="btn btn-small btn-secondary" onclick="openNewReferralModal('peter-williams')">Create Referral</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Tab -->
            <div id="analytics" class="tab-content">
                <div class="card">
                    <h2 style="margin-bottom: 20px;">Practice Analytics & AI Performance</h2>
                    
                    <div class="quick-stats" style="grid-template-columns: repeat(4, 1fr); margin-bottom: 30px;">
                        <div class="stat-card">
                            <div class="stat-number">156</div>
                            <div class="stat-label">Total Patients</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">24</div>
                            <div class="stat-label">Active Referrals</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">96%</div>
                            <div class="stat-label">AI Match Accuracy</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">2.1</div>
                            <div class="stat-label">Avg Wait Time (days)</div>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 30px;">
                        <div style="background: #f8f9ff; padding: 20px; border-radius: 10px;">
                            <h3>AI Performance Metrics <span class="ai-priority-badge">ðŸ¤– Live Data</span></h3>
                            <div class="detail-row">
                                <span class="detail-label">AI Match Accuracy:</span>
                                <span class="detail-value">96.2% (+1.2%)</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Recommendations Accepted:</span>
                                <span class="detail-value">94.7% (+2.1%)</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Time Saved per Referral:</span>
                                <span class="detail-value">14 minutes</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Patient Satisfaction:</span>
                                <span class="detail-value">4.9/5 (+0.1)</span>
                            </div>
                        </div>

                        <div style="background: #f8f9ff; padding: 20px; border-radius: 10px;">
                            <h3>Monthly Trends</h3>
                            <div class="detail-row">
                                <span class="detail-label">Referrals This Month:</span>
                                <span class="detail-value">52 (+18%)</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Average Response Time:</span>
                                <span class="detail-value">2.1 days (-0.4)</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Urgent Cases:</span>
                                <span class="detail-value">9 (17%)</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Completion Rate:</span>
                                <span class="detail-value">98.5% (+1.5%)</span>
                            </div>
                        </div>
                    </div>

                    <div style="background: #f8f9ff; padding: 20px; border-radius: 10px;">
                        <h3>Top Specialties This Month</h3>
                        <table class="referral-table">
                            <thead>
                                <tr>
                                    <th>Specialty</th>
                                    <th>Referrals</th>
                                    <th>Avg Wait Time</th>
                                    <th>AI Accuracy</th>
                                    <th>Success Rate</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Cardiology <span class="ai-priority-badge">ðŸ¤– Optimized</span></td>
                                    <td>15</td>
                                    <td>1.6 days</td>
                                    <td>97%</td>
                                    <td>98%</td>
                                </tr>
                                <tr>
                                    <td>Orthopedics</td>
                                    <td>12</td>
                                    <td>2.8 days</td>
                                    <td>95%</td>
                                    <td>96%</td>
                                </tr>
                                <tr>
                                    <td>Dermatology</td>
                                    <td>9</td>
                                    <td>1.9 days</td>
                                    <td>94%</td>
                                    <td>99%</td>
                                </tr>
                                <tr>
                                    <td>Neurology</td>
                                    <td>8</td>
                                    <td>2.5 days</td>
                                    <td>93%</td>
                                    <td>94%</td>
                                </tr>
                                <tr>
                                    <td>Gastroenterology</td>
                                    <td>8</td>
                                    <td>3.1 days</td>
                                    <td>96%</td>
                                    <td>97%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Messages Tab -->
            <div id="messages" class="tab-content">
                <div class="card">
                    <h2 style="margin-bottom: 20px;">Secure Messages & Communications</h2>
                    
                    <div class="search-container">
                        <input type="text" class="search-input" placeholder="Search messages or contacts...">
                        <span class="search-icon">ðŸ”</span>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 25px;">
                        <!-- Conversation List -->
                        <div>
                            <h3 style="margin-bottom: 15px;">Recent Conversations</h3>
                            <div class="recent-activity">
                                <div class="activity-item" onclick="openMessageThread('dr-smith')">
                                    <div class="activity-icon">ðŸ‘¨â€âš•ï¸</div>
                                    <div class="activity-content">
                                        <div class="activity-title"><strong>Dr. John Smith</strong> - Cardiologist 
                                            <span class="ai-priority-badge">ðŸ¤– 95% Match</span>
                                        </div>
                                        <div style="margin: 5px 0; color: #333; font-size: 13px;">Emma Thompson consultation confirmed...</div>
                                        <div class="activity-time">1 hour ago</div>
                                    </div>
                                </div>

                                <div class="activity-item" onclick="openMessageThread('coordinator')">
                                    <div class="activity-icon">ðŸ¥</div>
                                    <div class="activity-content">
                                        <div class="activity-title"><strong>Hospital Coordinator</strong></div>
                                        <div style="margin: 5px 0; color: #333; font-size: 13px;">ICU bed availability update</div>
                                        <div class="activity-time">3 hours ago</div>
                                    </div>
                                </div>

                                <div class="activity-item" onclick="openMessageThread('ai-system')">
                                    <div class="activity-icon">ðŸ¤–</div>
                                    <div class="activity-content">
                                        <div class="activity-title"><strong>MedConnect AI</strong></div>
                                        <div style="margin: 5px 0; color: #333; font-size: 13px;">Weekly performance report available</div>
                                        <div class="activity-time">5 hours ago</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Message Thread -->
                        <div>
                            <h3 style="margin-bottom: 15px;">Dr. John Smith - Cardiologist</h3>
                            <div class="message-thread">
                                <div class="message received">
                                    <div class="message-bubble">
                                        <strong>Dr. John Smith</strong>
                                        <div>Good afternoon Dr. Mitchell. I've received Emma Thompson's referral for urgent cardiac assessment. I can schedule her for tomorrow at 2:00 PM. Her ECG readings are concerning and warrant immediate evaluation.</div>
                                    </div>
                                    <div class="message-time">Today, 10:30 AM</div>
                                </div>

                                <div class="message sent">
                                    <div class="message-bubble">
                                        <strong>You</strong>
                                        <div>Perfect timing, Dr. Smith. I'll inform Emma about the appointment. Should I have her fast for any tests? Also, I'll send through the full clinical notes via the system now.</div>
                                    </div>
                                    <div class="message-time">Today, 10:40 AM</div>
                                </div>

                                <div class="message received">
                                    <div class="message-bubble">
                                        <strong>Dr. John Smith</strong>
                                        <div>Yes, please ask her to fast from midnight tonight. I'll arrange for an echocardiogram and stress test if needed. I'll also arrange for direct admission if required.</div>
                                    </div>
                                    <div class="message-time">Today, 11:15 AM</div>
                                </div>
                            </div>

                            <div style="border-top: 1px solid #dee2e6; padding-top: 15px;">
                                <div style="display: flex; gap: 10px;">
                                    <input type="text" placeholder="Type your message..." style="flex: 1; padding: 12px; border: 1px solid #e0e6ff; border-radius: 8px;">
                                    <button class="btn-success" style="padding: 0 20px;">Send</button>
                                </div>
                                <div style="font-size: 12px; color: #666; margin-top: 5px; display: flex; align-items: center; gap: 5px;">
                                    ðŸ”’ End-to-end encrypted
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile Tab -->
            <div id="profile" class="tab-content">
                <div class="card">
                    <h2 style="margin-bottom: 20px;">Profile & Settings</h2>
                    
                    <div class="filter-tabs" style="margin-bottom: 30px;">
                        <button class="filter-tab active" onclick="showProfileTab('personal')">Personal Info</button>
                        <button class="filter-tab" onclick="showProfileTab('practice')">Practice Details</button>
                        <button class="filter-tab" onclick="showProfileTab('security')">Security</button>
                        <button class="filter-tab" onclick="showProfileTab('integrations')">Integrations</button>
                        <button class="filter-tab" onclick="showProfileTab('notifications')">Notifications</button>
                    </div>

                    <!-- Personal Info Tab -->
                    <div id="personal" class="profile-tab-content">
                        <h3 style="margin-bottom: 20px;">Personal Information</h3>
                        <div class="form-grid-2">
                            <div class="form-group">
                                <label>First Name</label>
                                <input type="text" value="Sarah" onchange="handleFormChange(this)">
                            </div>
                            <div class="form-group">
                                <label>Last Name</label>
                                <input type="text" value="Mitchell" onchange="handleFormChange(this)">
                            </div>
                        </div>
                        <div class="form-grid-2">
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" value="sarah.mitchell@medconnect.com" onchange="handleFormChange(this)">
                            </div>
                            <div class="form-group">
                                <label>Phone</label>
                                <input type="tel" value="+61 3 9123 4567" onchange="handleFormChange(this)">
                            </div>
                        </div>
                        <div class="form-grid-2">
                            <div class="form-group">
                                <label>AHPRA Registration</label>
                                <input type="text" value="MED0001234567" onchange="handleFormChange(this)">
                            </div>
                            <div class="form-group">
                                <label>Specialization</label>
                                <input type="text" value="General Practice" onchange="handleFormChange(this)">
                            </div>
                        </div>
                        <button class="btn" onclick="saveProfile()">Save Changes</button>
                    </div>

                    <!-- Practice Details Tab -->
                    <div id="practice" class="profile-tab-content" style="display: none;">
                        <h3 style="margin-bottom: 20px;">Practice Details</h3>
                        <div class="form-group">
                            <label>Practice Name</label>
                            <input type="text" value="Melbourne Family Medical Centre" onchange="handleFormChange(this)">
                        </div>
                        <div class="form-group">
                            <label>Practice Address</label>
                            <textarea rows="3" onchange="handleFormChange(this)">123 Collins Street
Melbourne VIC 3000
Australia</textarea>
                        </div>
                        <div class="form-grid-2">
                            <div class="form-group">
                                <label>Practice Phone</label>
                                <input type="tel" value="+61 3 9876 5432" onchange="handleFormChange(this)">
                            </div>
                            <div class="form-group">
                                <label>Practice Email</label>
                                <input type="email" value="admin@melbournefmc.com.au" onchange="handleFormChange(this)">
                            </div>
                        </div>
                        <button class="btn" onclick="saveProfile()">Save Changes</button>
                    </div>

                    <!-- Security Tab -->
                    <div id="security" class="profile-tab-content" style="display: none;">
                        <h3 style="margin-bottom: 20px;">Security Settings</h3>
                        <div class="form-group">
                            <label>Current Password</label>
                            <input type="password" placeholder="Enter current password">
                        </div>
                        <div class="form-group">
                            <label>New Password</label>
                            <input type="password" placeholder="Enter new password">
                        </div>
                        <div class="form-group">
                            <label>Confirm New Password</label>
                            <input type="password" placeholder="Confirm new password">
                        </div>
                        <div style="margin: 20px 0;">
                            <div class="notification-toggle">
                                <span>Two-Factor Authentication</span>
                                <div class="toggle-switch active" onclick="toggleSwitch(this)">
                                    <div class="toggle-slider"></div>
                                </div>
                            </div>
                        </div>
                        <button class="btn" onclick="updateSecurity()">Update Security</button>
                    </div>

                    <!-- Integrations Tab -->
                    <div id="integrations" class="profile-tab-content" style="display: none;">
                        <h3 style="margin-bottom: 20px;">System Integrations</h3>
                        
                        <div class="specialist-card">
                            <div class="specialist-header">
                                <span class="specialist-name">AHPRA Professional Registration</span>
                                <span class="status-badge status-routine">CONNECTED</span>
                            </div>
                            <div class="specialist-details">
                                <div>Registration: MED0001234567</div>
                                <div>Status: Active</div>
                                <div>Expiry: 31/05/2025</div>
                                <div>Last Sync: 2 hours ago</div>
                            </div>
                        </div>

                        <div class="specialist-card">
                            <div class="specialist-header">
                                <span class="specialist-name">PRODA Provider Digital Access</span>
                                <span class="status-badge status-routine">CONNECTED</span>
                            </div>
                            <div class="specialist-details">
                                <div>Provider ID: PRV789123456</div>
                                <div>Status: Verified</div>
                                <div>Access Level: Full</div>
                                <div>Last Sync: 1 hour ago</div>
                            </div>
                        </div>

                        <div class="specialist-card">
                            <div class="specialist-header">
                                <span class="specialist-name">My Health Record</span>
                                <span class="status-badge status-routine">CONNECTED</span>
                            </div>
                            <div class="specialist-details">
                                <div>Healthcare Provider: HPI-I 8003619900041243</div>
                                <div>Status: Authorized</div>
                                <div>Access Level: Read/Write</div>
                                <div>Last Sync: 30 minutes ago</div>
                            </div>
                        </div>

                        <div class="specialist-card">
                            <div class="specialist-header">
                                <span class="specialist-name">Practice Management System</span>
                                <span class="status-badge status-pending">NOT CONNECTED</span>
                            </div>
                            <div class="specialist-details">
                                <div>System: MedicalDirector Clinical</div>
                                <div>Status: Setup Required</div>
                                <div>Action: Contact IT Support</div>
                                <div>Benefits: Auto-sync patient data</div>
                            </div>
                            <div style="margin-top: 10px;">
                                <button class="btn btn-secondary" onclick="setupIntegration()">Setup Integration</button>
                            </div>
                        </div>
                    </div>

                    <!-- Notifications Tab -->
                    <div id="notifications" class="profile-tab-content" style="display: none;">
                        <h3 style="margin-bottom: 20px;">Notification Preferences</h3>
                        
                        <div class="notification-toggle">
                            <div>
                                <strong>Email Notifications</strong>
                                <div style="font-size: 13px; color: #666;">Receive referral updates via email</div>
                            </div>
                            <div class="toggle-switch active" onclick="toggleSwitch(this)">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>

                        <div class="notification-toggle">
                            <div>
                                <strong>SMS Notifications</strong>
                                <div style="font-size: 13px; color: #666;">Urgent referral alerts via SMS</div>
                            </div>
                            <div class="toggle-switch active" onclick="toggleSwitch(this)">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>

                        <div class="notification-toggle">
                            <div>
                                <strong>Push Notifications</strong>
                                <div style="font-size: 13px; color: #666;">Browser notifications for new messages</div>
                            </div>
                            <div class="toggle-switch" onclick="toggleSwitch(this)">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>

                        <div class="notification-toggle">
                            <div>
                                <strong>AI Insights</strong>
                                <div style="font-size: 13px; color: #666;">Daily AI recommendations and alerts</div>
                            </div>
                            <div class="toggle-switch active" onclick="toggleSwitch(this)">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>

                        <div class="notification-toggle">
                            <div>
                                <strong>Weekly Reports</strong>
                                <div style="font-size: 13px; color: #666;">Practice analytics and performance summaries</div>
                            </div>
                            <div class="toggle-switch active" onclick="toggleSwitch(this)">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>

                        <button class="btn" onclick="saveNotificationPreferences()">Save Preferences</button>
                    </div>
                </div>
            </div>

            <!-- Support Center Tab -->
            <div id="support" class="tab-content">
                <div class="card">
                    <h2 style="margin-bottom: 20px;">Support Center</h2>
                    
                    <div class="support-grid">
                        <div class="support-card">
                            <div class="support-icon">ðŸ“š</div>
                            <h3>Documentation</h3>
                            <p style="color: #6c757d; margin: 1rem 0;">Access user guides, tutorials, and API documentation</p>
                            <button class="btn-secondary" onclick="openDocumentation()">Browse Docs</button>
                        </div>
                        <div class="support-card">
                            <div class="support-icon">ðŸ’¬</div>
                            <h3>Live Chat</h3>
                            <p style="color: #6c757d; margin: 1rem 0;">Chat with our support team in real-time</p>
                            <button class="btn-secondary" onclick="startLiveChat()">Start Chat</button>
                        </div>
                        <div class="support-card">
                            <div class="support-icon">ðŸ“§</div>
                            <h3>Email Support</h3>
                            <p style="color: #6c757d; margin: 1rem 0;">Send us a detailed inquiry</p>
                            <button class="btn-secondary" onclick="openEmailSupport()">Send Email</button>
                        </div>
                    </div>

                    <div class="card" style="margin-top: 30px;">
                        <h3 style="margin-bottom: 20px;">Submit Support Request</h3>
                        <div class="form-group">
                            <label>Request Type</label>
                            <select id="supportRequestType">
                                <option>Technical Issue</option>
                                <option>Feature Request</option>
                                <option>Account Question</option>
                                <option>Billing Inquiry</option>
                                <option>Integration Support</option>
                                <option>Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Subject</label>
                            <input type="text" id="supportSubject" placeholder="Brief description of your issue">
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="supportDescription" rows="6" placeholder="Please provide detailed information about your request..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Priority</label>
                            <select id="supportPriority">
                                <option>Low - General inquiry</option>
                                <option>Medium - Impacting work</option>
                                <option>High - Urgent issue</option>
                                <option>Critical - System down</option>
                            </select>
                        </div>
                        <button class="btn" onclick="submitSupportRequest()">Submit Request</button>
                    </div>

                    <div class="faq-section" style="margin-top: 30px;">
                        <h3 style="margin-bottom: 20px;">Frequently Asked Questions</h3>
                        
                        <div class="faq-item">
                            <div class="faq-question" onclick="toggleFAQ(this)">
                                How do I create a new referral?
                                <span>â–¼</span>
                            </div>
                            <div class="faq-answer">
                                To create a new referral, click the "Create New Referral" button on the Referrals tab. The AI system will guide you through patient selection, clinical information entry, and specialist matching to ensure optimal care coordination.
                            </div>
                        </div>

                        <div class="faq-item">
                            <div class="faq-question" onclick="toggleFAQ(this)">
                                What does the AI matching score mean?
                                <span>â–¼</span>
                            </div>
                            <div class="faq-answer">
                                The AI matching score represents the system's confidence in recommending a specialist based on clinical condition, urgency, location, availability, and historical outcomes. Scores above 90% indicate excellent matches.
                            </div>
                        </div>

                        <div class="faq-item">
                            <div class="faq-question" onclick="toggleFAQ(this)">
                                How do I update patient information?
                                <span>â–¼</span>
                            </div>
                            <div class="faq-answer">
                                Go to the Patients tab, find the patient, and click "View Details". Then use the "Edit Information" button. The system will prompt you to notify relevant specialists and update connected systems like My Health Record.
                            </div>
                        </div>

                        <div class="faq-item">
                            <div class="faq-question" onclick="toggleFAQ(this)">
                                Is my data secure and compliant?
                                <span>â–¼</span>
                            </div>
                            <div class="faq-answer">
                                Yes, MedConnect AI is fully compliant with Australian Privacy Act 1988, integrates with AHPRA and PRODA, and uses end-to-end encryption for all communications. All data is stored within Australian borders.
                            </div>
                        </div>

                        <div class="faq-item">
                            <div class="faq-question" onclick="toggleFAQ(this)">
                                How do I integrate with my existing practice management system?
                                <span>â–¼</span>
                            </div>
                            <div class="faq-answer">
                                Visit the Integrations tab in your Profile settings. We support major systems like MedicalDirector, Best Practice, and Zedmed. Contact our technical team for assistance with custom integrations.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Patient Details Modal -->
    <div id="patientDetailsModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>Patient Details - Emma Thompson</h2>
                <button class="close-btn" onclick="closeModal('patientDetailsModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #e0e6ff;">
                    <div>
                        <h3 style="margin: 0;">Emma Thompson</h3>
                        <div style="color: #666; margin-top: 5px;">MRN: MCA-2024-0156 | Female, 45 years old 
                            <span class="ai-priority-badge">ðŸ¤– AI Monitored</span>
                        </div>
                    </div>
                    <div>
                        <button class="btn btn-secondary" onclick="editPatient('emma-thompson')">âœï¸ Edit Information</button>
                        <button class="btn-success" onclick="openNewReferralModal('emma-thompson')">âž• Create Referral</button>
                    </div>
                </div>

                <h4 style="margin-bottom: 15px;">Personal Information</h4>
                <div class="detail-row">
                    <span class="detail-label">Full Name:</span>
                    <span class="detail-value">Emma Louise Thompson</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Date of Birth:</span>
                    <span class="detail-value">15/08/1979</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Medicare Number:</span>
                    <span class="detail-value">2847 59183 4</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Phone:</span>
                    <span class="detail-value">0412 345 678</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Email:</span>
                    <span class="detail-value">emma.thompson@email.com</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Address:</span>
                    <span class="detail-value">45 Spring Street, Melbourne VIC 3000</span>
                </div>

                <h4 style="margin: 20px 0 15px 0;">Medical Information</h4>
                <div class="detail-row">
                    <span class="detail-label">Blood Type:</span>
                    <span class="detail-value">O+</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Known Allergies:</span>
                    <span class="detail-value">Penicillin, Shellfish</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Current Medications:</span>
                    <span class="detail-value">Metformin 500mg BD, Amlodipine 5mg OD</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Medical History:</span>
                    <span class="detail-value">Type 2 Diabetes (2018), Hypertension (2020)</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Emergency Contact:</span>
                    <span class="detail-value">John Thompson (Husband) - 0423 456 789</span>
                </div>

                <h4 style="margin: 20px 0 15px 0;">Recent Activity</h4>
                <div class="recent-activity">
                    <div class="activity-item">
                        <div class="activity-icon">ðŸ“‹</div>
                        <div class="activity-content">
                            <div class="activity-title">Urgent Referral Created 
                                <span class="ai-priority-badge">ðŸ¤– AI Assisted</span>
                            </div>
                            <div class="activity-time">Cardiology - Today, 2:30 PM</div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">ðŸ“…</div>
                        <div class="activity-content">
                            <div class="activity-title">Consultation</div>
                            <div class="activity-time">Chest pain assessment - Oct 15, 2024</div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">ðŸ”¬</div>
                        <div class="activity-content">
                            <div class="activity-title">Test Results</div>
                            <div class="activity-time">ECG, Blood work - Oct 14, 2024</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('patientDetailsModal')">Close</button>
                <button class="btn-secondary" onclick="exportPatientData()">Export Data</button>
                <button class="btn" onclick="editPatient('emma-thompson')">Edit Patient</button>
            </div>
        </div>
    </div>

    <!-- New Referral Modal -->
    <div id="newReferralModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>Create New Referral - AI-Enhanced</h2>
                <button class="close-btn" onclick="closeModal('newReferralModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="progress-indicator">
                    <div class="progress-step">
                        <div class="progress-dot active">1</div>
                        <div class="progress-line"></div>
                        <div class="progress-label">Patient</div>
                    </div>
                    <div class="progress-step">
                        <div class="progress-dot">2</div>
                        <div class="progress-line"></div>
                        <div class="progress-label">Clinical</div>
                    </div>
                    <div class="progress-step">
                        <div class="progress-dot">3</div>
                        <div class="progress-line"></div>
                        <div class="progress-label">Specialist</div>
                    </div>
                    <div class="progress-step">
                        <div class="progress-dot">4</div>
                        <div class="progress-label">Review</div>
                    </div>
                </div>

                <div class="ai-suggestion-box">
                    <strong>ðŸ¤– AI ASSIST:</strong> I'll help you create this referral efficiently. Start by searching for an existing patient or create a new patient profile.
                </div>

                <h3 style="margin-bottom: 15px;">Step 1: Patient Information</h3>
                
                <div class="form-group">
                    <label>Search Patient</label>
                    <input type="text" placeholder="Search by name, Medicare number, or MRN..." id="patientSearch" onchange="handleFormChange(this)">
                    <div style="text-align: center; margin: 10px 0;">
                        <button type="button" class="btn-secondary" onclick="openNewPatientFromReferral()">+ Create New Patient</button>
                    </div>
                </div>

                <div class="form-grid-2">
                    <div class="form-group required">
                        <label>First Name</label>
                        <input type="text" id="referralFirstName" required onchange="handleFormChange(this)">
                    </div>
                    <div class="form-group required">
                        <label>Last Name</label>
                        <input type="text" id="referralLastName" required onchange="handleFormChange(this)">
                    </div>
                </div>

                <div class="form-grid-3">
                    <div class="form-group">
                        <label>Date of Birth</label>
                        <input type="date" id="referralDOB" onchange="handleFormChange(this)">
                    </div>
                    <div class="form-group">
                        <label>Medicare Number</label>
                        <input type="text" id="referralMedicare" placeholder="0000 00000 0" onchange="handleFormChange(this)">
                    </div>
                    <div class="form-group">
                        <label>Phone Number</label>
                        <input type="tel" id="referralPhone" placeholder="04XX XXX XXX" onchange="handleFormChange(this)">
                    </div>
                </div>

                <h3 style="margin: 25px 0 15px 0;">Step 2: Clinical Information</h3>
                
                <div class="form-grid-2">
                    <div class="form-group required">
                        <label>Primary Condition</label>
                        <input type="text" id="referralCondition" placeholder="e.g., Chest pain, Joint pain" required onchange="handleFormChange(this)">
                    </div>
                    <div class="form-group required">
                        <label>Urgency Level</label>
                        <select id="referralUrgency" required onchange="handleFormChange(this)">
                            <option value="">Select Urgency</option>
                            <option value="urgent">Urgent (24-48 hours)</option>
                            <option value="semi-urgent">Semi-Urgent (1-2 weeks)</option>
                            <option value="routine">Routine (4-6 weeks)</option>
                        </select>
                    </div>
                </div>

                <div class="form-group required">
                    <label>Clinical Notes</label>
                    <textarea id="referralNotes" rows="4" placeholder="Enter clinical observations, test results, and relevant medical history..." required onchange="handleFormChange(this)"></textarea>
                </div>

                <div class="form-group">
                    <label>Symptoms & Duration</label>
                    <textarea id="referralSymptoms" rows="3" placeholder="Describe symptoms and their duration..." onchange="handleFormChange(this)"></textarea>
                </div>

                <h3 style="margin: 25px 0 15px 0;">Step 3: Specialist Selection</h3>
                
                <div class="form-group required">
                    <label>Required Specialty</label>
                    <select id="referralSpecialty" onchange="loadSpecialists()" required>
                        <option value="">Select Specialty</option>
                        <option value="cardiology">Cardiology</option>
                        <option value="orthopedics">Orthopedics</option>
                        <option value="dermatology">Dermatology</option>
                        <option value="neurology">Neurology</option>
                        <option value="gastroenterology">Gastroenterology</option>
                        <option value="endocrinology">Endocrinology</option>
                        <option value="rheumatology">Rheumatology</option>
                    </select>
                </div>

                <!-- Specialist Selection Area -->
                <div id="specialistSelection" style="display: none;">
                    <div class="ai-suggestion-box">
                        <strong>ðŸ¤– AI RECOMMENDATION:</strong> Based on the clinical information provided, here are the best matched specialists:
                    </div>
                    
                    <div id="specialistList">
                        <!-- Specialists will be loaded here -->
                    </div>
                </div>

                <div class="form-group">
                    <label>Preferred Appointment Date</label>
                    <input type="date" id="referralPreferredDate" onchange="handleFormChange(this)">
                </div>

                <div style="margin-top: 20px;">
                    <label class="checkbox-label">
                        <input type="checkbox" id="patientConsent" onchange="handleFormChange(this)"> Patient consents to sharing medical information
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="copyToMHR" onchange="handleFormChange(this)"> Copy referral to My Health Record
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('newReferralModal')">Cancel</button>
                <button class="btn-secondary" onclick="saveDraft()">ðŸ’¾ Save as Draft</button>
                <button class="btn" onclick="submitReferral()">âœ“ Create Referral</button>
            </div>
        </div>
    </div>

    <!-- Referral Details Modal -->
    <div id="referralDetailsModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>Referral Details - #2025-1245</h2>
                <button class="close-btn" onclick="closeModal('referralDetailsModal')">&times;</button>
            </div>
            <div class="modal-body">
                <h3 style="margin-bottom: 20px;">Referral Status Tracking</h3>
                
                <div class="status-timeline">
                    <div class="status-step">
                        <div class="status-dot completed">âœ“</div>
                        <div class="status-label">Created</div>
                        <div class="status-time">16/10 8:23 AM</div>
                    </div>
                    <div class="status-step">
                        <div class="status-dot completed">âœ“</div>
                        <div class="status-label">AI Triaged</div>
                        <div class="status-time">16/10 8:25 AM</div>
                    </div>
                    <div class="status-step">
                        <div class="status-dot completed">âœ“</div>
                        <div class="status-label">Specialist Review</div>
                        <div class="status-time">16/10 10:15 AM</div>
                    </div>
                    <div class="status-step">
                        <div class="status-dot current">4</div>
                        <div class="status-label">Accepted</div>
                        <div class="status-time">16/10 10:30 AM</div>
                    </div>
                    <div class="status-step">
                        <div class="status-dot">5</div>
                        <div class="status-label">Appointment</div>
                        <div class="status-time">Tomorrow</div>
                    </div>
                </div>

                <div class="ai-status-box">
                    <strong>ðŸ¤– AI Status:</strong> Referral processed successfully. Estimated appointment completion: 17/10/2025. Post-consultation report expected within 48 hours.
                </div>

                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #e0e6ff;">
                    <div>
                        <h3 style="margin: 0;">John Mitchell - Cardiology Referral</h3>
                        <div style="color: #666; margin-top: 5px;">#2025-1245 | Created: 16/10/2024 | 
                            <span class="status-badge status-routine">ACCEPTED</span>
                            <span class="ai-priority-badge">ðŸ¤– 95% Match</span>
                        </div>
                    </div>
                    <div>
                        <button class="btn btn-secondary">ðŸ“„ Download PDF</button>
                        <button class="btn-success">âœ“ Update Status</button>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px;">
                    <!-- Patient Information -->
                    <div>
                        <h4 style="margin-bottom: 15px;">Patient Information</h4>
                        <div class="detail-row">
                            <span class="detail-label">Name:</span>
                            <span class="detail-value">John Mitchell</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">DOB:</span>
                            <span class="detail-value">15/03/1967 (58 years, Male)</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Medicare:</span>
                            <span class="detail-value">2942 12345 6/1</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Contact:</span>
                            <span class="detail-value">0412 345 678 | john.mitchell@email.com</span>
                        </div>
                    </div>

                    <!-- Specialist Information -->
                    <div>
                        <h4 style="margin-bottom: 15px;">Specialist Information</h4>
                        <div class="detail-row">
                            <span class="detail-label">Specialist:</span>
                            <span class="detail-value">Dr. Sarah Johnson</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Specialty:</span>
                            <span class="detail-value">Cardiology</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Practice:</span>
                            <span class="detail-value">Melbourne Heart Centre</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">AI Match:</span>
                            <span class="detail-value"><span class="ai-match-score">95% Match</span></span>
                        </div>
                    </div>
                </div>

                <h4 style="margin: 25px 0 15px 0;">Clinical Information</h4>
                <div class="detail-row">
                    <span class="detail-label">Primary Condition:</span>
                    <span class="detail-value">Chest Pain - Cardiac Assessment</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Clinical Notes:</span>
                    <span class="detail-value">58-year-old male presenting with intermittent chest pain over past 2 weeks. Pain described as central, crushing, radiating to left arm. Associated with exertion, relieved by rest. Family history of cardiac disease. Risk factors include hypertension and hyperlipidemia.</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Urgency:</span>
                    <span class="detail-value"><span class="status-badge status-routine">ROUTINE</span> - 2-4 weeks</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('referralDetailsModal')">Close</button>
                <button class="btn-secondary" onclick="downloadReferralPDF()">Download PDF</button>
                <button class="btn-secondary" onclick="sendMessage()">Send Message</button>
                <button class="btn" onclick="updateReferralStatus()">Update Status</button>
            </div>
        </div>
    </div>

    <!-- Specialist Query Response Modal -->
    <div id="specialistQueryModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>ðŸ“‹ Respond to Specialist Query</h2>
                <button class="close-btn" onclick="closeModal('specialistQueryModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="urgent-banner" style="margin-bottom: 20px;">
                    <div class="urgent-content">
                        <div class="urgent-icon">âš ï¸</div>
                        <div><strong>RESPONSE OVERDUE BY 2 DAYS</strong><br>
                        Dr. Lisa Wong is requesting additional clinical information for Sarah O'Brien's neurology referral.</div>
                    </div>
                </div>

                <div class="query-details">
                    <h4 style="margin-bottom: 15px;">Query Details</h4>
                    <div class="detail-row">
                        <span class="detail-label">Specialist:</span>
                        <span class="detail-value">Dr. Lisa Wong - Neurology</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Patient:</span>
                        <span class="detail-value">Sarah O'Brien (F, 42y | MCA-2024-1234)</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Referral ID:</span>
                        <span class="detail-value">#2025-1244</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Query Date:</span>
                        <span class="detail-value">14/10/2025 2:30 PM</span>
                    </div>
                </div>

                <h4 style="margin: 20px 0 15px 0;">ðŸ“‹ Specialist's Questions</h4>

                <div class="query-question">
                    <strong>Dr. Wong's Query:</strong>
                    <p style="margin-top: 10px;">"Thank you for the referral. To better assess Sarah's chronic headaches, I need additional information:</p>
                    <ol style="margin: 10px 0; padding-left: 20px;">
                        <li>Family history of migraines or neurological conditions</li>
                        <li>Detailed headache pattern - frequency, triggers, associated symptoms</li>
                        <li>Previous imaging results (mentions CT was normal - need date and details)</li>
                        <li>Current and previous medications tried for headache management</li>
                        <li>Any recent changes in headache pattern or severity</li>
                    </ol>
                    <p>Please provide this information so I can provide the most appropriate care."</p>
                </div>

                <div class="query-response-area">
                    <h4 style="margin-bottom: 15px;">Your Response</h4>
                    <div class="ai-suggestion-box">
                        <strong>ðŸ¤– AI ASSIST:</strong> I've pre-filled some information from Sarah's medical record. Please review and add any additional details.
                    </div>
                    
                    <div class="form-group">
                        <label>Response to Specialist Query</label>
                        <textarea id="specialistResponse" placeholder="Enter your detailed response to Dr. Wong's questions...">Dear Dr. Wong,

Thank you for accepting Sarah O'Brien's referral. Here are the requested details:

1. Family History: Mother had migraines, started in her 30s. No other significant neurological family history.

2. Headache Pattern: 
   - Frequency: 3-4 episodes per week, increasing from 1-2/week over past 6 months
   - Triggers: Stress, bright lights, certain foods (chocolate, aged cheese)
   - Associated symptoms: Nausea, photophobia, occasional visual aura
   - Duration: 4-12 hours if untreated

3. Previous Imaging: CT brain scan performed 15/08/2024 at Royal Melbourne Hospital - reported as normal, no acute findings

4. Medications Tried:
   - Current: Paracetamol 1g PRN (limited effectiveness)
   - Previous: Ibuprofen 400mg (caused gastric upset)
   - Trial of sumatriptan 50mg - patient declined due to cost

5. Recent Changes: Headaches have become more frequent and severe over past 6 months. Patient reports sleep disruption and impact on work performance.

Additional notes: Patient is otherwise well, non-smoker, occasional alcohol use. BP consistently normal. No concerning neurological signs on examination.

Please let me know if you need any further information.

Best regards,
Dr. Sarah Mitchell</textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('specialistQueryModal')">Cancel</button>
                <button class="btn-secondary" onclick="saveDraft()">ðŸ’¾ Save Draft</button>
                <button class="btn-success" onclick="sendSpecialistResponse()">âœ… Send Response</button>
            </div>
        </div>
    </div>

    <!-- Escalate & Re-route Modal -->
    <div id="escalateModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>ðŸš¨ Escalate & Re-route Referral</h2>
                <button class="close-btn" onclick="closeModal('escalateModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="urgent-banner" style="margin-bottom: 20px;">
                    <div class="urgent-content">
                        <div class="urgent-icon">âš ï¸</div>
                        <div><strong>OVERDUE REFERRAL DETECTED</strong><br>
                        Original referral to Dr. Raj Patel sent 3 days ago with no response. Patient experiencing worsening symptoms.</div>
                    </div>
                </div>

                <div class="query-details">
                    <h4 style="margin-bottom: 15px;">Original Referral Details</h4>
                    <div class="detail-row">
                        <span class="detail-label">Patient:</span>
                        <span class="detail-value">Michael Brown (M, 48y | MCA-2022-5678)</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Original Referral:</span>
                        <span class="detail-value">Dr. Raj Patel - Gastroenterology</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Sent Date:</span>
                        <span class="detail-value">14/10/2025 10:45 AM</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Days Overdue:</span>
                        <span class="detail-value" style="color: #e74c3c; font-weight: 600;">3 days</span>
                    </div>
                </div>

                <h4 style="margin: 25px 0 15px 0;">ðŸ¤– AI-Recommended Alternative Specialists</h4>

                <div class="alternative-specialist">
                    <div class="specialist-header">
                        <h4 style="margin: 0;">Dr. Michael Wong</h4>
                        <span style="font-size: 14px; color: #666;">Gastroenterologist</span>
                    </div>
                    <div style="margin: 10px 0; font-weight: 600;">Austin Hospital - Gastroenterology</div>
                    
                    <div class="specialist-stats">
                        <div class="specialist-stat">
                            <div class="specialist-stat-value">ðŸ“ 6.8km</div>
                            <div class="specialist-stat-label">from patient</div>
                        </div>
                        <div class="specialist-stat">
                            <div class="specialist-stat-value">â­ 4.8/5.0</div>
                            <div class="specialist-stat-label">(156 reviews)</div>
                        </div>
                        <div class="specialist-stat">
                            <div class="specialist-stat-value">94%</div>
                            <div class="specialist-stat-label">Acceptance Rate</div>
                        </div>
                        <div class="specialist-stat">
                            <div class="specialist-stat-value">1.2 hours</div>
                            <div class="specialist-stat-label">Avg response</div>
                        </div>
                        <div class="specialist-stat">
                            <div class="specialist-stat-value">âœ“</div>
                            <div class="specialist-stat-label">Bulk billing available</div>
                        </div>
                    </div>
                </div>

                <div class="ai-suggestion-box">
                    <strong>ðŸ¤– AI RECOMMENDATION:</strong> Based on patient location, symptom urgency, and specialist availability, Dr. Michael Wong is the optimal alternative with 96% confidence match and fastest response time.
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('escalateModal')">Cancel</button>
                <button class="btn-secondary" onclick="contactOriginalSpecialist()">ðŸ“ž Contact Dr. Patel</button>
                <button class="btn-urgent" onclick="escalateToNewSpecialist()">ðŸš¨ ESCALATE TO NEW SPECIALIST</button>
            </div>
        </div>
    </div>

    <!-- New Patient Modal -->
    <div id="newPatientModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>Add New Patient - Complete Registration</h2>
                <button class="close-btn" onclick="closeModal('newPatientModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="ai-suggestion-box">
                    <strong>ðŸ¤– AI ASSIST:</strong> I'll help you register this new patient with all required medical and contact information.
                </div>

                <h3 style="margin-bottom: 15px;">Personal Information</h3>
                <div class="form-grid-2">
                    <div class="form-group required">
                        <label>First Name</label>
                        <input type="text" id="newPatientFirstName" required>
                    </div>
                    <div class="form-group required">
                        <label>Last Name</label>
                        <input type="text" id="newPatientLastName" required>
                    </div>
                </div>

                <div class="form-grid-3">
                    <div class="form-group required">
                        <label>Date of Birth</label>
                        <input type="date" id="newPatientDOB" required>
                    </div>
                    <div class="form-group required">
                        <label>Gender</label>
                        <select id="newPatientGender" required>
                            <option value="">Select Gender</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                            <option value="prefer-not-to-say">Prefer not to say</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Title</label>
                        <select id="newPatientTitle">
                            <option value="">Select Title</option>
                            <option value="mr">Mr</option>
                            <option value="mrs">Mrs</option>
                            <option value="ms">Ms</option>
                            <option value="dr">Dr</option>
                            <option value="prof">Prof</option>
                        </select>
                    </div>
                </div>

                <h3 style="margin: 25px 0 15px 0;">Contact Information</h3>
                <div class="form-grid-2">
                    <div class="form-group required">
                        <label>Phone Number</label>
                        <input type="tel" id="newPatientPhone" placeholder="04XX XXX XXX" required>
                    </div>
                    <div class="form-group">
                        <label>Email Address</label>
                        <input type="email" id="newPatientEmail" placeholder="patient@email.com">
                    </div>
                </div>

                <div class="form-group required">
                    <label>Home Address</label>
                    <textarea id="newPatientAddress" rows="3" placeholder="Street address, suburb, state, postcode" required></textarea>
                </div>

                <h3 style="margin: 25px 0 15px 0;">Healthcare Information</h3>
                <div class="form-grid-2">
                    <div class="form-group required">
                        <label>Medicare Number</label>
                        <input type="text" id="newPatientMedicare" placeholder="0000 00000 0" required>
                    </div>
                    <div class="form-group">
                        <label>Private Health Insurance</label>
                        <input type="text" id="newPatientInsurance" placeholder="Insurance provider and number">
                    </div>
                </div>

                <div class="form-grid-2">
                    <div class="form-group">
                        <label>Blood Type</label>
                        <select id="newPatientBloodType">
                            <option value="">Select Blood Type</option>
                            <option value="a-positive">A+</option>
                            <option value="a-negative">A-</option>
                            <option value="b-positive">B+</option>
                            <option value="b-negative">B-</option>
                            <option value="ab-positive">AB+</option>
                            <option value="ab-negative">AB-</option>
                            <option value="o-positive">O+</option>
                            <option value="o-negative">O-</option>
                            <option value="unknown">Unknown</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Preferred Language</label>
                        <select id="newPatientLanguage">
                            <option value="english">English</option>
                            <option value="mandarin">Mandarin</option>
                            <option value="italian">Italian</option>
                            <option value="greek">Greek</option>
                            <option value="arabic">Arabic</option>
                            <option value="vietnamese">Vietnamese</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>

                <h3 style="margin: 25px 0 15px 0;">Medical History</h3>
                <div class="form-group">
                    <label>Known Allergies</label>
                    <textarea id="newPatientAllergies" rows="2" placeholder="List any known allergies (medications, foods, environmental)"></textarea>
                </div>

                <div class="form-group">
                    <label>Current Medications</label>
                    <textarea id="newPatientMedications" rows="3" placeholder="List current medications with dosages"></textarea>
                </div>

                <div class="form-group">
                    <label>Medical Conditions</label>
                    <textarea id="newPatientConditions" rows="3" placeholder="List any chronic conditions or ongoing health issues"></textarea>
                </div>

                <h3 style="margin: 25px 0 15px 0;">Emergency Contact</h3>
                <div class="form-grid-2">
                    <div class="form-group required">
                        <label>Emergency Contact Name</label>
                        <input type="text" id="newPatientEmergencyName" required>
                    </div>
                    <div class="form-group required">
                        <label>Relationship</label>
                        <select id="newPatientEmergencyRelation" required>
                            <option value="">Select Relationship</option>
                            <option value="spouse">Spouse</option>
                            <option value="parent">Parent</option>
                            <option value="child">Child</option>
                            <option value="sibling">Sibling</option>
                            <option value="friend">Friend</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>

                <div class="form-grid-2">
                    <div class="form-group required">
                        <label>Emergency Contact Phone</label>
                        <input type="tel" id="newPatientEmergencyPhone" placeholder="04XX XXX XXX" required>
                    </div>
                    <div class="form-group">
                        <label>Emergency Contact Email</label>
                        <input type="email" id="newPatientEmergencyEmail">
                    </div>
                </div>

                <h3 style="margin: 25px 0 15px 0;">Consent & Preferences</h3>
                <div style="margin-top: 20px;">
                    <label class="checkbox-label">
                        <input type="checkbox" id="newPatientConsentTreatment" checked> I consent to medical treatment and examination
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="newPatientConsentMHR" checked> I consent to My Health Record integration
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="newPatientConsentCommunication"> I consent to SMS and email communications
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="newPatientInterpreter"> I require interpreter services
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="newPatientPrivacy" checked> I have read and agree to the Privacy Policy
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('newPatientModal')">Cancel</button>
                <button class="btn-secondary" onclick="savePatientDraft()">ðŸ’¾ Save as Draft</button>
                <button class="btn" onclick="createNewPatient()">âœ“ Register Patient</button>
            </div>
        </div>
    </div>

    <!-- Auto-save indicator -->
    <div id="autoSaveIndicator" class="auto-save-indicator">
        âœ“ Auto-saved
    </div>

    <script>
        // Set current date to October 2024 to match appointment data
        let currentDate = new Date(2024, 9, 17); // October 17, 2024
        let currentMonth = currentDate.getMonth(); // 9 (October)
        let currentYear = currentDate.getFullYear(); // 2024

        // Global state
        let autoSaveTimer = null;
        let selectedSpecialist = null;

        // Sample appointment data with comprehensive scheduling
        const appointments = {
            '2024-10-17': [
                { time: '9:00 AM', title: 'James Wilson', type: 'consultation' },
                { time: '10:30 AM', title: 'Lisa Chen', type: 'follow-up' },
                { time: '2:00 PM', title: 'Robert Taylor', type: 'consultation' },
                { time: '3:30 PM', title: 'Emma Thompson', type: 'urgent' }
            ],
            '2024-10-18': [
                { time: '9:30 AM', title: 'Michael Brown', type: 'consultation' },
                { time: '11:00 AM', title: 'Sarah Davis', type: 'follow-up' },
                { time: '2:30 PM', title: 'Patricia Wilson', type: 'consultation' },
                { time: '4:00 PM', title: 'Kevin Martinez', type: 'urgent' }
            ],
            '2024-10-19': [
                { time: '10:00 AM', title: 'Jennifer Lee', type: 'consultation' },
                { time: '1:30 PM', title: 'Brian Clark', type: 'follow-up' },
                { time: '3:00 PM', title: 'Margaret Davis', type: 'consultation' }
            ],
            '2024-10-21': [
                { time: '9:15 AM', title: 'John Smith', type: 'consultation' },
                { time: '10:45 AM', title: 'Carol Johnson', type: 'follow-up' },
                { time: '2:30 PM', title: 'Emily Johnson', type: 'follow-up' },
                { time: '4:00 PM', title: 'David Wilson', type: 'consultation' }
            ],
            '2024-10-22': [
                { time: '9:00 AM', title: 'Linda Garcia', type: 'urgent' },
                { time: '10:30 AM', title: 'Steven Rodriguez', type: 'consultation' },
                { time: '11:30 AM', title: 'Peter Taylor', type: 'consultation' },
                { time: '1:00 PM', title: 'Rebecca White', type: 'follow-up' },
                { time: '2:30 PM', title: 'Thomas Anderson', type: 'consultation' },
                { time: '3:15 PM', title: 'Andrew Miller', type: 'consultation' }
            ],
            '2024-10-23': [
                { time: '9:15 AM', title: 'Sophie Turner', type: 'consultation' },
                { time: '10:30 AM', title: 'Rachel Green', type: 'follow-up' },
                { time: '11:00 AM', title: 'Mark Thompson', type: 'urgent' },
                { time: '1:45 PM', title: 'Jennifer Wilson', type: 'consultation' },
                { time: '2:45 PM', title: 'Amanda Rodriguez', type: 'follow-up' },
                { time: '4:15 PM', title: 'Christopher Lee', type: 'consultation' }
            ],
            '2024-10-24': [
                { time: '9:00 AM', title: 'Elizabeth Taylor', type: 'consultation' },
                { time: '10:30 AM', title: 'Christopher Lee', type: 'consultation' },
                { time: '1:15 PM', title: 'Michelle Davis', type: 'follow-up' },
                { time: '2:45 PM', title: 'Joseph Martinez', type: 'consultation' },
                { time: '4:00 PM', title: 'Barbara Moore', type: 'follow-up' }
            ],
            '2024-10-25': [
                { time: '9:45 AM', title: 'Daniel Moore', type: 'consultation' },
                { time: '11:30 AM', title: 'Jessica Anderson', type: 'urgent' },
                { time: '1:00 PM', title: 'William Johnson', type: 'consultation' },
                { time: '2:00 PM', title: 'Ryan Jackson', type: 'consultation' },
                { time: '3:15 PM', title: 'Mary Williams', type: 'follow-up' },
                { time: '3:45 PM', title: 'Nicole Harris', type: 'follow-up' }
            ],
            '2024-10-28': [
                { time: '9:30 AM', title: 'Anthony Davis', type: 'consultation' },
                { time: '11:00 AM', title: 'Helen Garcia', type: 'follow-up' },
                { time: '2:15 PM', title: 'Paul Rodriguez', type: 'consultation' },
                { time: '3:30 PM', title: 'Nancy Miller', type: 'urgent' }
            ],
            '2024-10-29': [
                { time: '9:00 AM', title: 'Richard Wilson', type: 'consultation' },
                { time: '10:15 AM', title: 'Sandra Moore', type: 'follow-up' },
                { time: '1:30 PM', title: 'Betty Taylor', type: 'consultation' },
                { time: '2:45 PM', title: 'Gary Anderson', type: 'follow-up' },
                { time: '4:00 PM', title: 'Donna Jackson', type: 'consultation' }
            ],
            '2024-10-30': [
                { time: '10:00 AM', title: 'Kenneth Martin', type: 'consultation' },
                { time: '11:30 AM', title: 'Lisa Thompson', type: 'urgent' },
                { time: '1:15 PM', title: 'Mark White', type: 'follow-up' },
                { time: '3:00 PM', title: 'Maria Lopez', type: 'consultation' }
            ],
            '2024-10-31': [
                { time: '9:30 AM', title: 'Donald Lee', type: 'consultation' },
                { time: '11:00 AM', title: 'Carol Hall', type: 'follow-up' },
                { time: '2:00 PM', title: 'Steven Allen', type: 'consultation' }
            ]
        };

        // Days that are unavailable (weekends, holidays, etc.)
        const unavailableDays = ['2024-10-20', '2024-10-26', '2024-10-27']; // Sunday and some other unavailable days

        // Sample specialist data
        const specialists = {
            cardiology: [
                {
                    name: 'Dr. John Smith',
                    practice: 'Melbourne Heart Centre',
                    distance: '2.1 km',
                    rating: '4.9',
                    nextSlot: 'Tomorrow 2:00 PM',
                    aiMatch: '97%',
                    experience: '15 years',
                    subspecialty: 'Interventional Cardiology'
                },
                {
                    name: 'Dr. Sarah Williams',
                    practice: 'Royal Melbourne Cardiology',
                    distance: '3.5 km',
                    rating: '4.8',
                    nextSlot: 'Monday 10:30 AM',
                    aiMatch: '94%',
                    experience: '12 years',
                    subspecialty: 'Heart Failure'
                },
                {
                    name: 'Dr. Michael Chen',
                    practice: 'Austin Heart Institute',
                    distance: '5.2 km',
                    rating: '4.7',
                    nextSlot: 'Tuesday 3:00 PM',
                    aiMatch: '89%',
                    experience: '18 years',
                    subspecialty: 'Electrophysiology'
                }
            ],
            orthopedics: [
                {
                    name: 'Dr. Sarah Johnson',
                    practice: 'Melbourne Orthopaedic Group',
                    distance: '1.8 km',
                    rating: '4.8',
                    nextSlot: 'Monday 9:00 AM',
                    aiMatch: '96%',
                    experience: '14 years',
                    subspecialty: 'Joint Replacement'
                },
                {
                    name: 'Dr. David Lee',
                    practice: 'Sports Medicine Centre',
                    distance: '4.1 km',
                    rating: '4.9',
                    nextSlot: 'Wednesday 2:00 PM',
                    aiMatch: '92%',
                    experience: '16 years',
                    subspecialty: 'Sports Injuries'
                }
            ],
            dermatology: [
                {
                    name: 'Dr. Mike Brown',
                    practice: 'Melbourne Dermatology Clinic',
                    distance: '2.8 km',
                    rating: '4.7',
                    nextSlot: 'Friday 11:00 AM',
                    aiMatch: '93%',
                    experience: '11 years',
                    subspecialty: 'Skin Cancer'
                }
            ]
        };

        // Patient data
        const patientData = {
            'emma-thompson': {
                firstName: 'Emma',
                lastName: 'Thompson',
                dob: '1979-08-15',
                medicare: '2847 59183 4',
                phone: '0412 345 678',
                email: 'emma.thompson@email.com'
            },
            'john-davis': {
                firstName: 'John',
                lastName: 'Davis',
                dob: '1962-03-22',
                medicare: '3956 48271 9',
                phone: '0423 567 890',
                email: 'john.davis@email.com'
            },
            'maria-garcia': {
                firstName: 'Maria',
                lastName: 'Garcia',
                dob: '1986-11-08',
                medicare: '4738 29516 2',
                phone: '0434 678 901',
                email: 'maria.garcia@email.com'
            },
            'peter-williams': {
                firstName: 'Peter',
                lastName: 'Williams',
                dob: '1973-07-14',
                medicare: '5829 37164 8',
                phone: '0445 789 012',
                email: 'peter.williams@email.com'
            }
        };

        // Authentication functions
        function ssoLogin(provider) {
            showToast(`Redirecting to ${provider.toUpperCase()} login...`, 'info');
            setTimeout(() => {
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('appContainer').classList.add('active');
                showToast('Login successful!', 'success');
            }, 2000);
        }

        function login(event) {
            event.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (email && password) {
                const loginBtn = event.target.querySelector('button[type="submit"]');
                loginBtn.classList.add('loading');
                loginBtn.textContent = 'Signing in...';
                
                setTimeout(() => {
                    document.getElementById('loginPage').style.display = 'none';
                    document.getElementById('appContainer').classList.add('active');
                    showToast('Login successful!', 'success');
                }, 2000);
            } else {
                showToast('Please enter email and password', 'error');
            }
        }

        function logout() {
            showToast('Logging out...', 'info');
            setTimeout(() => {
                document.getElementById('appContainer').classList.remove('active');
                document.getElementById('loginPage').style.display = 'flex';
                showToast('Logged out successfully', 'success');
            }, 1000);
        }

        // Tab switching function
        function showTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(tab => tab.classList.remove('active'));

            // Remove active class from all tab buttons
            const tabButtons = document.querySelectorAll('.nav-tab');
            tabButtons.forEach(btn => btn.classList.remove('active'));

            // Show selected tab content
            document.getElementById(tabName).classList.add('active');

            // Add active class to clicked tab button
            event.target.classList.add('active');

            // Initialize calendar if calendar tab is selected
            if (tabName === 'calendar') {
                setTimeout(() => {
                    generateCalendar(currentMonth, currentYear);
                }, 100);
            }

            // Close user dropdown
            document.getElementById('userDropdown').classList.remove('show');
        }

        // Profile tab switching
        function showProfileTab(tabName) {
            // Hide all profile tab contents
            const profileTabContents = document.querySelectorAll('.profile-tab-content');
            profileTabContents.forEach(tab => tab.style.display = 'none');

            // Remove active class from all profile tab buttons
            const profileTabButtons = document.querySelectorAll('#profile .filter-tab');
            profileTabButtons.forEach(btn => btn.classList.remove('active'));

            // Show selected profile tab content
            document.getElementById(tabName).style.display = 'block';

            // Add active class to clicked tab button
            event.target.classList.add('active');
        }

        // User dropdown functions
        function toggleUserDropdown() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('show');
        }

        // Calendar functions
        function generateCalendar(month, year) {
            const monthNames = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"];
            
            document.getElementById('currentMonth').textContent = `${monthNames[month]} ${year}`;
            
            const calendarGrid = document.getElementById('calendarGrid');
            calendarGrid.innerHTML = '';

            // Add day headers
            const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            dayHeaders.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-day-header';
                dayHeader.textContent = day;
                calendarGrid.appendChild(dayHeader);
            });

            // Get first day of month and number of days
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date(2024, 9, 17); // Set today to October 17, 2024
            
            // Add empty cells for days before the first day of the month
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day other-month';
                calendarGrid.appendChild(emptyDay);
            }

            // Add days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                
                const dayNumber = document.createElement('div');
                dayNumber.className = 'day-number';
                dayNumber.textContent = day;
                dayElement.appendChild(dayNumber);

                // Check if this is today
                if (year === today.getFullYear() && month === today.getMonth() && day === today.getDate()) {
                    dayElement.classList.add('today');
                }

                // Check if this day is unavailable
                const dateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                if (unavailableDays.includes(dateString)) {
                    dayElement.classList.add('unavailable');
                } else {
                    // Add appointments for this day (only for available days)
                    if (appointments[dateString]) {
                        console.log(`Adding ${appointments[dateString].length} appointments for ${dateString}`);
                        appointments[dateString].forEach(apt => {
                            const appointmentElement = document.createElement('div');
                            appointmentElement.className = `appointment ${apt.type}`;
                            appointmentElement.textContent = `${apt.time}`;
                            appointmentElement.title = `${apt.time} - ${apt.title}`;
                            appointmentElement.onclick = (e) => {
                                e.stopPropagation();
                                showAppointmentDetails(apt);
                            };
                            dayElement.appendChild(appointmentElement);
                        });
                    }
                }

                dayElement.onclick = () => selectDate(day, month, year);
                calendarGrid.appendChild(dayElement);
            }
        }

        function previousMonth() {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            generateCalendar(currentMonth, currentYear);
        }

        function nextMonth() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            generateCalendar(currentMonth, currentYear);
        }

        function todayView() {
            const today = new Date(2024, 9, 17); // October 17, 2024
            currentMonth = today.getMonth();
            currentYear = today.getFullYear();
            generateCalendar(currentMonth, currentYear);
        }

        function selectDate(day, month, year) {
            const selectedDate = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            showToast(`Selected date: ${selectedDate}`, 'info');
        }

        function showAppointmentDetails(appointment) {
            showToast(`Appointment: ${appointment.title} - ${appointment.time} (${appointment.type})`, 'info');
        }

        // Modal functions
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
            if (modalId === 'newReferralModal') {
                resetReferralForm();
            }
        }

        function openNewReferralModal(patientId = null) {
            resetReferralForm();
            if (patientId && patientData[patientId]) {
                const patient = patientData[patientId];
                document.getElementById('referralFirstName').value = patient.firstName;
                document.getElementById('referralLastName').value = patient.lastName;
                document.getElementById('referralDOB').value = patient.dob;
                document.getElementById('referralMedicare').value = patient.medicare;
                document.getElementById('referralPhone').value = patient.phone;
            }
            document.getElementById('newReferralModal').classList.add('show');
        }

        function openUrgentReferral() {
            resetReferralForm();
            // Pre-populate Emma Thompson's urgent referral
            const patient = patientData['emma-thompson'];
            document.getElementById('referralFirstName').value = patient.firstName;
            document.getElementById('referralLastName').value = patient.lastName;
            document.getElementById('referralDOB').value = patient.dob;
            document.getElementById('referralMedicare').value = patient.medicare;
            document.getElementById('referralPhone').value = patient.phone;
            document.getElementById('referralCondition').value = 'Chest Pain - Cardiac Assessment';
            document.getElementById('referralUrgency').value = 'urgent';
            document.getElementById('referralNotes').value = 'Patient presenting with acute chest pain, shortness of breath. ECG shows irregular rhythm. Requires immediate cardiology consultation for assessment of potential cardiac event.';
            document.getElementById('referralSymptoms').value = 'Chest pain (8/10), shortness of breath, fatigue. Started 2 hours ago.';
            document.getElementById('referralSpecialty').value = 'cardiology';
            loadSpecialists(); // Load specialists immediately
            document.getElementById('newReferralModal').classList.add('show');
        }

        function openPatientDetails(patientId) {
            if (patientData[patientId]) {
                const patient = patientData[patientId];
                const modal = document.getElementById('patientDetailsModal');
                modal.querySelector('.modal-header h2').textContent = `Patient Details - ${patient.firstName} ${patient.lastName}`;
            }
            document.getElementById('patientDetailsModal').classList.add('show');
        }

        function openReferralDetails(referralId) {
            document.getElementById('referralDetailsModal').classList.add('show');
        }

        // Task Management Functions
        function showAllTasks() {
            showToast('Opening all tasks view...', 'info');
        }

        function openSpecialistQuery(referralId) {
            document.getElementById('specialistQueryModal').classList.add('show');
        }

        function sendSpecialistResponse() {
            const response = document.getElementById('specialistResponse').value;
            if (!response.trim()) {
                showToast('Please enter a response', 'error');
                return;
            }

            showToast('Sending response to Dr. Wong...', 'info');
            setTimeout(() => {
                showToast('Response sent successfully! Dr. Wong will be notified.', 'success');
                closeModal('specialistQueryModal');
                // Remove the task from dashboard
                updateTaskStatus('REF2025-1244', 'completed');
            }, 2000);
        }

        function completeChecklist(patientId) {
            showToast(`Opening pre-appointment checklist for ${patientId}...`, 'info');
        }

        function reviewTestResults(patientId) {
            showToast(`Opening test results for ${patientId}...`, 'info');
        }

        function scheduleHealthCheck(patientId) {
            showToast(`Scheduling health check for ${patientId}...`, 'info');
        }

        function openEscalateModal(patientId) {
            document.getElementById('escalateModal').classList.add('show');
        }

        function contactOriginalSpecialist() {
            showToast('Calling Dr. Raj Patel...', 'info');
            setTimeout(() => {
                showToast('Call connected. Voicemail left requesting urgent response.', 'success');
            }, 3000);
        }

        function escalateToNewSpecialist() {
            showToast('Escalating referral to Dr. Michael Wong...', 'info');
            setTimeout(() => {
                showToast('Referral escalated successfully! Dr. Wong has been notified and will respond within 2 hours.', 'success');
                closeModal('escalateModal');
                // Update the dashboard to remove the overdue banner
                const banner = document.querySelector('.overdue-referral-banner');
                if (banner) {
                    banner.style.display = 'none';
                }
            }, 2500);
        }

        function updateTaskStatus(taskId, status) {
            // In a real system, this would update the task status
            console.log(`Task ${taskId} updated to ${status}`);
        }

        function openNewPatientFromReferral() {
            // Set flag to indicate we're coming from referral modal
            window.fromReferralModal = true;
            openNewPatientModal();
        }

        function openNewPatientModal() {
            // Reset the form
            resetNewPatientForm();
            document.getElementById('newPatientModal').classList.add('show');
        }

        function resetNewPatientForm() {
            // Reset all input fields in the new patient modal
            const inputs = document.querySelectorAll('#newPatientModal input, #newPatientModal select, #newPatientModal textarea');
            inputs.forEach(input => {
                input.value = '';
                input.classList.remove('error');
                if (input.type === 'checkbox') {
                    // Set default checkbox states
                    if (input.id === 'newPatientConsentTreatment' || 
                        input.id === 'newPatientConsentMHR' || 
                        input.id === 'newPatientPrivacy') {
                        input.checked = true;
                    } else {
                        input.checked = false;
                    }
                }
            });
        }

        function createNewPatient() {
            // Validate required fields
            const requiredFields = [
                { id: 'newPatientFirstName', name: 'First Name' },
                { id: 'newPatientLastName', name: 'Last Name' },
                { id: 'newPatientDOB', name: 'Date of Birth' },
                { id: 'newPatientGender', name: 'Gender' },
                { id: 'newPatientPhone', name: 'Phone Number' },
                { id: 'newPatientAddress', name: 'Address' },
                { id: 'newPatientMedicare', name: 'Medicare Number' },
                { id: 'newPatientEmergencyName', name: 'Emergency Contact Name' },
                { id: 'newPatientEmergencyRelation', name: 'Emergency Contact Relationship' },
                { id: 'newPatientEmergencyPhone', name: 'Emergency Contact Phone' }
            ];
            
            let isValid = true;
            const errors = [];

            requiredFields.forEach(field => {
                const element = document.getElementById(field.id);
                if (!element.value.trim()) {
                    element.classList.add('error');
                    errors.push(field.name);
                    isValid = false;
                } else {
                    element.classList.remove('error');
                }
            });

            // Check consent checkboxes
            const requiredConsents = ['newPatientConsentTreatment', 'newPatientPrivacy'];
            requiredConsents.forEach(consentId => {
                const checkbox = document.getElementById(consentId);
                if (!checkbox.checked) {
                    errors.push('Required consent');
                    isValid = false;
                }
            });

            if (!isValid) {
                showToast(`Please fill in: ${errors.join(', ')}`, 'error');
                return;
            }

            // Simulate patient creation
            const patientData = {
                firstName: document.getElementById('newPatientFirstName').value,
                lastName: document.getElementById('newPatientLastName').value,
                dob: document.getElementById('newPatientDOB').value,
                medicare: document.getElementById('newPatientMedicare').value,
                phone: document.getElementById('newPatientPhone').value
            };

            showToast('Creating patient profile...', 'info');
            setTimeout(() => {
                const patientId = 'MCA-2024-' + String(Math.floor(Math.random() * 1000) + 400).padStart(4, '0');
                showToast(`Patient ${patientData.firstName} ${patientData.lastName} registered successfully! ID: ${patientId}`, 'success');
                
                // Check if we're coming from referral modal
                if (window.fromReferralModal) {
                    // Pre-populate referral form with new patient data
                    document.getElementById('referralFirstName').value = patientData.firstName;
                    document.getElementById('referralLastName').value = patientData.lastName;
                    document.getElementById('referralDOB').value = patientData.dob;
                    document.getElementById('referralMedicare').value = patientData.medicare;
                    document.getElementById('referralPhone').value = patientData.phone;
                    
                    window.fromReferralModal = false;
                    closeModal('newPatientModal');
                    showToast('Patient added to referral form', 'success');
                } else {
                    closeModal('newPatientModal');
                }
            }, 2000);
        }

        function savePatientDraft() {
            showToast('Patient information saved as draft', 'success');
            triggerAutoSave();
        }

        function openAppointmentModal() {
            showToast('Add Appointment Modal would open here', 'info');
        }

        function resetReferralForm() {
            // Reset all input fields
            const inputs = document.querySelectorAll('#newReferralModal input, #newReferralModal select, #newReferralModal textarea');
            inputs.forEach(input => {
                input.value = '';
                input.classList.remove('error');
                if (input.type === 'checkbox') {
                    input.checked = false;
                }
            });
            // Hide specialist selection
            document.getElementById('specialistSelection').style.display = 'none';
            selectedSpecialist = null;
        }

        // Load specialists based on selected specialty
        function loadSpecialists() {
            const specialty = document.getElementById('referralSpecialty').value;
            const specialistSelection = document.getElementById('specialistSelection');
            const specialistList = document.getElementById('specialistList');

            if (specialty && specialists[specialty]) {
                specialistSelection.style.display = 'block';
                specialistList.innerHTML = '';

                specialists[specialty].forEach((specialist, index) => {
                    const specialistCard = document.createElement('div');
                    specialistCard.className = 'specialist-card';
                    if (index === 0) specialistCard.classList.add('ai-recommended');
                    specialistCard.onclick = () => selectSpecialist(specialty, index);
                    
                    specialistCard.innerHTML = `
                        <div class="specialist-header">
                            <span class="specialist-name">${specialist.name}</span>
                            <span class="ai-match-score">ðŸ¤– ${specialist.aiMatch} AI Match</span>
                        </div>
                        <div class="specialist-details">
                            <div><strong>Practice:</strong> ${specialist.practice}</div>
                            <div><strong>Distance:</strong> ${specialist.distance}</div>
                            <div><strong>Rating:</strong> â­ ${specialist.rating}/5</div>
                            <div><strong>Next Available:</strong> ${specialist.nextSlot}</div>
                            <div><strong>Experience:</strong> ${specialist.experience}</div>
                            <div><strong>Subspecialty:</strong> ${specialist.subspecialty}</div>
                        </div>
                    `;
                    
                    specialistList.appendChild(specialistCard);
                });
            } else {
                specialistSelection.style.display = 'none';
            }
        }

        function selectSpecialist(specialty, index) {
            // Remove selection from all specialist cards
            document.querySelectorAll('.specialist-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Add selection to clicked card
            document.querySelectorAll('.specialist-card')[index].classList.add('selected');
            
            // Store selected specialist data
            selectedSpecialist = specialists[specialty][index];
            showToast(`Selected: ${selectedSpecialist.name}`, 'success');
        }

        function editPatient(patientId) {
            showNotificationOptions('Are you sure you want to update this patient information?', [
                'Notify referred specialist',
                'Send update to patient via SMS',
                'Update My Health Record',
                'Notify emergency contact'
            ]);
        }

        function showNotificationOptions(message, options) {
            let optionsHtml = options.map(option => 
                `<label class="checkbox-label">
                    <input type="checkbox" checked> ${option}
                </label>`
            ).join('');

            const modal = document.createElement('div');
            modal.className = 'modal show';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Update Notifications</h3>
                        <button class="close-btn" onclick="this.closest('.modal').remove()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <p>${message}</p>
                        <div style="margin: 20px 0;">
                            ${optionsHtml}
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn-secondary" onclick="this.closest('.modal').remove()">Cancel</button>
                        <button class="btn" onclick="confirmUpdate(this)">Confirm Update</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function confirmUpdate(button) {
            const modal = button.closest('.modal');
            const checkedOptions = Array.from(modal.querySelectorAll('input[type="checkbox"]:checked'))
                .map(cb => cb.parentElement.textContent.trim());
            
            showToast(`Patient updated! Notifications sent to: ${checkedOptions.join(', ')}`, 'success');
            modal.remove();
        }

        function showNotifications() {
            showToast('3 new notifications', 'info');
        }

        function filterReferrals(filter) {
            // Remove active class from all filter tabs
            const filterTabs = document.querySelectorAll('#referrals .filter-tab');
            filterTabs.forEach(tab => tab.classList.remove('active'));
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            showToast(`Filtering by: ${filter}`, 'info');
        }

        function toggleSwitch(element) {
            element.classList.toggle('active');
        }

        function toggleFAQ(element) {
            const answer = element.nextElementSibling;
            const icon = element.querySelector('span');
            
            if (answer.classList.contains('show')) {
                answer.classList.remove('show');
                icon.textContent = 'â–¼';
            } else {
                answer.classList.add('show');
                icon.textContent = 'â–²';
            }
        }

        function submitReferral() {
            // Validate required fields
            const requiredFields = [
                { id: 'referralFirstName', name: 'First Name' },
                { id: 'referralLastName', name: 'Last Name' },
                { id: 'referralCondition', name: 'Condition' },
                { id: 'referralUrgency', name: 'Urgency' },
                { id: 'referralNotes', name: 'Clinical Notes' },
                { id: 'referralSpecialty', name: 'Specialty' }
            ];
            
            let isValid = true;
            const errors = [];

            requiredFields.forEach(field => {
                const element = document.getElementById(field.id);
                if (!element.value.trim()) {
                    element.classList.add('error');
                    errors.push(field.name);
                    isValid = false;
                } else {
                    element.classList.remove('error');
                }
            });

            if (!isValid) {
                showToast(`Please fill in: ${errors.join(', ')}`, 'error');
                return;
            }

            if (!selectedSpecialist) {
                showToast('Please select a specialist', 'error');
                return;
            }

            // Simulate referral creation
            const referralData = {
                patient: document.getElementById('referralFirstName').value + ' ' + document.getElementById('referralLastName').value,
                condition: document.getElementById('referralCondition').value,
                urgency: document.getElementById('referralUrgency').value,
                specialist: selectedSpecialist.name,
                notes: document.getElementById('referralNotes').value
            };

            showToast('Creating referral...', 'info');
            setTimeout(() => {
                const refId = 'REF' + (Math.floor(Math.random() * 1000) + 100);
                showToast(`Referral ${refId} created successfully! Specialist: ${selectedSpecialist.name}`, 'success');
                closeModal('newReferralModal');
            }, 2000);
        }

        function saveDraft() {
            showToast('Referral saved as draft', 'success');
            triggerAutoSave();
        }

        // Form change handler with auto-save
        function handleFormChange(element) {
            clearTimeout(autoSaveTimer);
            autoSaveTimer = setTimeout(() => {
                triggerAutoSave();
            }, 3000); // Auto-save after 3 seconds of no changes
        }

        function triggerAutoSave() {
            const indicator = document.getElementById('autoSaveIndicator');
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 2000);
        }

        // Toast notification system
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('hiding');
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 3000);
        }

        // Support functions
        function openDocumentation() {
            showToast('Opening documentation...', 'info');
        }

        function startLiveChat() {
            showToast('Connecting to support agent...', 'info');
        }

        function openEmailSupport() {
            showToast('Opening email composer...', 'info');
        }

        function submitSupportRequest() {
            const type = document.getElementById('supportRequestType').value;
            const subject = document.getElementById('supportSubject').value;
            const description = document.getElementById('supportDescription').value;
            const priority = document.getElementById('supportPriority').value;

            if (!subject || !description) {
                showToast('Please fill in subject and description', 'error');
                return;
            }

            showToast('Support request submitted successfully!', 'success');
            
            // Reset form
            document.getElementById('supportSubject').value = '';
            document.getElementById('supportDescription').value = '';
        }

        // Profile functions
        function saveProfile() {
            showToast('Profile saved successfully!', 'success');
        }

        function updateSecurity() {
            showToast('Security settings updated!', 'success');
        }

        function setupIntegration() {
            showToast('Integration setup initiated. Our team will contact you.', 'info');
        }

        function saveNotificationPreferences() {
            showToast('Notification preferences saved!', 'success');
        }

        // Other utility functions
        function updateReferralStatus() {
            showToast('Status update options would be shown here', 'info');
        }

        function downloadReferralPDF() {
            showToast('Downloading referral PDF...', 'info');
        }

        function sendMessage() {
            showToast('Opening secure message composer...', 'info');
        }

        function exportPatientData() {
            showToast('Exporting patient data to PDF...', 'info');
        }

        function downloadReport() {
            showToast('Downloading specialist report...', 'info');
        }

        function editReferral(referralId) {
            showToast(`Opening edit mode for referral ${referralId}`, 'info');
        }

        function openMessageThread(threadId) {
            showToast(`Opening message thread: ${threadId}`, 'info');
        }

        // Click outside to close modals and dropdowns
        document.addEventListener('click', function(event) {
            // Close user dropdown
            const userProfile = document.querySelector('.user-profile');
            const userDropdown = document.getElementById('userDropdown');
            if (!userProfile.contains(event.target)) {
                userDropdown.classList.remove('show');
            }

            // Close modals when clicking outside
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('show');
            }
        });

        // Initialize calendar on page load and ensure it's populated
        document.addEventListener('DOMContentLoaded', function() {
            // Generate calendar immediately
            generateCalendar(currentMonth, currentYear);
            
            // Search functionality
            const searchInputs = document.querySelectorAll('.search-input');
            searchInputs.forEach(input => {
                input.addEventListener('input', function(e) {
                    const searchTerm = e.target.value.toLowerCase();
                    if (searchTerm.length > 2) {
                        showToast(`Searching for: ${searchTerm}`, 'info');
                    }
                });
            });
        });
    </script>
</body>
</html>